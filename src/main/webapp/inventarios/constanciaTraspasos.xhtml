<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="/WEB-INF/template.xhtml">

	<ui:define name="title">Constancia de Traspasos</ui:define>

	<ui:define name="content">
		<h:form id="form">
			<p:breadCrumb>
				<p:menuitem value="Home" outcome="/dashboard" />
				<p:menuitem value="Inventarios" />
				<p:menuitem value="Servicios" />
				<p:menuitem value="Consultar"
					outcome="/inventarios/constanciaTraspasos" />
			</p:breadCrumb>
			<div class="p-grid crud-demo">
				<div class="p-col-12">
					<div class="card">
						
						<p:outputLabel value="Por Rango de Fechas:" />
						<p:datePicker id="fechaInicial" showIcon="true" styleClass="p-mr-4 p-mb-2" placeholder="Fecha de Inicio" value="#{consultaTraspasosBean.fecha_ini}" />
						<p:datePicker id="fechaFinal" showIcon="true" styleClass="p-mr-4 p-mb-2" placeholder="Fecha Final" value="#{consultaTraspasosBean.fecha_final}" />
						
						<p:outputLabel for="folio" value="Por Folio:" />
						<p:inputText id="folio" value="#{consultaTraspasosBean.numero}"/>
						<p:commandButton value="Consultar" styleClass="p-mr-2 p-mb-2" icon="pi pi-fw pi-search" actionListener="#{consultaTraspasosBean.buscarConstancia}" update="@widgetVar(dtConstanciaTraspaso) "/>
						
						<p:outputLabel for="cliente-som" value="Por Clientes:" />
						<p:selectOneMenu id="cliente-som" autoWidth="false" value="#{consultaTraspasosBean.idCliente}">
							<f:selectItem itemLabel="Selecione Cliente" itemValue="" noSelectionOption="true" />
							<f:selectItems var="cte" value="#{consultaTraspasosBean.clientes}" itemLabel="#{cte.cteNombre}" itemValue="#{cte.cteCve}" />
							<p:ajax listener="#{consultaTraspasosBean.filtrarCliente}" process="@this" update=":form:dt-traspaso "/>
						</p:selectOneMenu>
					</div>
				</div>
			</div>

			<div class="p-grid crud-demo">
				<div class="p-col-12">
					<div class="card">
						<p:growl id="messages" showDetail="true" />
						<p:dataTable id="dt-traspaso" widgetVar="dtConstanciaTraspaso" var="trasp" value="#{consultaTraspasosBean.listaTraspasos}" reflow="true" 
						rowKey="#{trasp.id}" paginator="true" rows="10" rowSelectMode="add" selectionMode="single" paginatorPosition="bottom">
				
							<p:column headerText="Folio" sortBy="#{trasp.numero}" filterBy="#{trasp.numero}" width="5rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{trasp.numero}" />
							</p:column>
							<p:column headerText="Cliente" sortBy="#{trasp.cliente.cteNombre}" filterBy="#{trasp.cliente.cteNombre}">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{trasp.cliente.cteNombre}" />
							</p:column>
							<p:column headerText="Fecha" sortBy="#{trasp.fecha}" filterBy="#{trasp.fecha}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{trasp.fecha}" />
							</p:column>
							<p:column width="10rem">
								<p:commandButton icon="pi pi-search" update=":form:constanciaDetalle " value="Ver detalle" oncomplete="PF('dlg-constancia').show()" styleClass="edit-button ui-button-info" process="@this">
									<f:setPropertyActionListener value="#{trasp}" target="#{consultaTraspasosBean.selectedconstancia}" />
								</p:commandButton>
							</p:column>
						</p:dataTable>
						
						<p:dialog header="Consulta de traspaso" showEffect="fade" var="consulta" modal="true" widgetVar="dlg-constancia" responsive="true" style="max-width:80em !important;" resizable="true">
							<p:ajax event="open" listener="#{consultaTraspasosBean.carga}"/>
							<p:outputPanel id="constanciaDetalle" class="ui-fluid">
								<p:outputPanel rendered="#{not empty consultaTraspasosBean.selectedconstancia}">
									<div class="p-grid">
									
									<p:panel id="Cliente">
					                <div class="field">
					                        <h:outputLabel for="cliente-new" value="Cliente" styleClass="ml-4" />
					                        <p:inputText widgetVar="cliente-new" id="cliente-new" value="#{consultaTraspasosBean.selectedconstancia.cliente.cteNombre}" readonly="true" />
					                </div>
					            </p:panel>
					            
									<p:panel id="Folio">
					                <div class="field">
					                        <h:outputLabel for="folio-new" value="Folio" styleClass="ml-4" />
					                        <p:inputText widgetVar="Folio-n" id="folio-new" value="#{consultaTraspasosBean.selectedconstancia.numero}" readonly="true" />
					                </div>
					            </p:panel>
					            
								<p:panel id="Fecha">
					                <div class="field">
					                        <h:outputLabel for="fecha-new" value="Fecha" styleClass="ml-4" />
					                        <p:inputText widgetVar="fecha-new" id="fecha-new" value="#{consultaTraspasosBean.selectedconstancia.fecha}" readonly="true"/>
					                </div>
					            </p:panel>
								<p:panel id="Observacion">
					                <div class="field">
					                        <h:outputLabel for="observacion-new" value="Observaciones" styleClass="ml-4" />
					                        <p:inputText widgetVar="observacion-new" id="observacion-new" value="#{consultaTraspasosBean.selectedconstancia.observacion}" readonly="true"/>
					                </div>
					            </p:panel>
					           </div>
					           <p:divider align="left">
        <div class="inline-flex align-items-center">
            <i class="pi pi-list mr-2"/>
            <b>Detalles de partida</b>
        </div>
    </p:divider>
						<p:dataTable id="dt-detalleConstancia" widgetVar="dtConstanciaTraspaso2" var="detallecons" value="#{consultaTraspasosBean.listaTraspasoPartida}" reflow="true" 
								paginator="true" rows="10" rowKey="#{detallecons.traspaso}" rowSelectMode="add" selectionMode="single" paginatorPosition="bottom">
				
							<p:column headerText="Traspaso" sortBy="#{detallecons.traspaso.id}" filterBy="#{detallecons.traspaso.id}" width="5rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{detallecons.traspaso.id}" />
							</p:column>
							
							<p:column headerText="Constancia" sortBy="#{detallecons.constancia}" filterBy="#{detallecons.constancia}">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{detallecons.constancia}" />
							</p:column>
							
							<p:column headerText="Partida" sortBy="#{detallecons.partida.partidaCve}" filterBy="#{detallecons.partida.partidaCve}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{detallecons.partida.partidaCve}" />
							</p:column>
							
							<p:column headerText="Descripcion" sortBy="#{detallecons.descripcion}" filterBy="#{detallecons.descripcion}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{detallecons.descripcion}" />
							</p:column>
							
							<p:column headerText="Cantidad" sortBy="#{detallecons.cantidad}" filterBy="#{detallecons.cantidad}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{detallecons.cantidad}" />
							</p:column>
							
							<p:column headerText="Origen" sortBy="#{detallecons.origen}" filterBy="#{detallecons.origen}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{detallecons.origen}" />
							</p:column>
							
							<p:column headerText="Destino" sortBy="#{detallecons.destino}" filterBy="#{detallecons.destino}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{detallecons.destino}" />
							</p:column>
							
						</p:dataTable>
	    <p:divider align="left">
        <div class="inline-flex align-items-center">
            <i class="pi pi-check-square mr-2"/>
            <b>Servicios designados</b>
        </div>
    </p:divider>
    		<p:dataTable id="dt-Servicios" widgetVar="dtServicios" var="servicios" value="#{consultaTraspasosBean.listaServicios}" reflow="true" 
								paginator="true" rows="10" rowKey="#{detallecons.traspaso}" rowSelectMode="add" selectionMode="single" paginatorPosition="bottom">
				
							<p:column headerText="Traspaso" sortBy="#{servicios.traspaso.id}" filterBy="#{servicios.traspaso.id}" width="5rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{servicios.traspaso.id}" />
							</p:column>

							<p:column headerText="Servicio" sortBy="#{servicios.servicio}" filterBy="#{servicios.servicio}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{servicios.servicio}" />
							</p:column>
							
							<p:column headerText="Cantidad" sortBy="#{servicios.cantidad}" filterBy="#{servicios.cantidad}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{servicios.cantidad}" />
							</p:column>
							
							<p:column headerText="Precio" sortBy="#{servicios.precio}" filterBy="#{servicios.precio}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{servicios.precio}"/>
							</p:column>
							
							<p:column headerText="Subtotal" sortBy="#{servicios.subtotal}" filterBy="#{servicios.subtotal}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem" value="#{servicios.subtotal}"/> 
							</p:column>
						</p:dataTable>
    					<pe:documentViewer id="documento" height="500" value="#{consultaTraspasosBean.reporte}" download="ReporteTraspaso.pdf"/>
				</p:outputPanel>
				</p:outputPanel>
							<f:facet name="footer">
								<p:commandButton value="Generar constancia" icon="pi pi-file-pdf" styleClass="ui-button-raised ui-button-secondary" actionListener="#{consultaTraspasosBean.jasper}" update="documento"/>
								<p:commandButton value="Cerrar" icon="pi pi-times" oncomplete="PF('dlg-constancia').hide()" />
							</f:facet>
						</p:dialog>
					</div>
				</div>
			</div>
		</h:form>
	</ui:define>

</ui:composition>