<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/template.xhtml">

	<ui:define name="title">Alta Constancia Salida</ui:define>

	<ui:define name="content">
		<h:form id="form">
			<p:breadCrumb>
				<p:menuitem value="Home" outcome="/dashboard" />
				<p:menuitem value="Inventarios" />
				<p:menuitem value="Salidas" />
				<p:menuitem value="Alta" outcome="/inventarios/altaConstanciaSalida" />
			</p:breadCrumb>
						<p:growl id="messages" showDetail="true" life="4000"/>
						<p:toolbar>
							<p:toolbarGroup id="datos-generales" >
							
								<p:outputLabel value="Cliente:" styleClass="p-mr-2"/>
									<p:selectOneMenu id="s-cliente" autoWidth="false" converter="entityConverter" value="#{altaConstanciaSalidaBean.clienteSelect}">
										<f:selectItem itemLabel="Seleccione un cliente" itemValue="" noSelectionOption="true" />
										<f:selectItems value="#{altaConstanciaSalidaBean.listadoClientes}" var="cliente" itemLabel="#{cliente.cteNombre}" itemValue="#{cliente}" />
										<p:ajax listener="#{altaConstanciaSalidaBean.servicioCliente}" update="datos-generales s-servicio  dt-inventario s-planta" />
									</p:selectOneMenu>
								<p:outputLabel value="Planta:" styleClass="p-ml-4 p-mr-2"/>
									<p:selectOneMenu id="s-planta" autoWidth="false" converter="entityConverter" value="#{altaConstanciaSalidaBean.plantaSelect}">
										<f:selectItem itemLabel="Seleccione Planta" itemValue="" noSelectionOption="true" />
										<f:selectItems value="#{altaConstanciaSalidaBean.listadoPlantas}" var="planta" itemLabel="#{planta.plantaDs}" itemValue="#{planta}" />
										<p:ajax update="datos-generales dt-inventario" listener="#{altaConstanciaSalidaBean.servicioCliente}"/>
									</p:selectOneMenu>
								<p:outputLabel value="Fecha:" styleClass="p-ml-4 p-mr-2" />
									<p:datePicker id="fechaSalida" showIcon="true" styleClass="p-mr-4 p-mb-2" placeholder="Fecha de Salida" value="#{altaConstanciaSalidaBean.fechaSalida}">
										<p:ajax update="datos-generales"/>
									</p:datePicker>
								<p:outputLabel value="Folio:" styleClass="p-ml-4 p-mr-2"/>
									<p:inputText id="folio" placeholder="Ingresa Folio" value="#{altaConstanciaSalidaBean.numFolio}">
										<p:ajax update="datos-generales" />
									</p:inputText>
								
							 	<div style="margin-left: 4px">
									<p:commandButton value="Asignar" actionListener="#{altaConstanciaSalidaBean.validar()}" styleClass="ui-button-success" icon="pi pi-plus"/>
								</div>
						
							</p:toolbarGroup>
						</p:toolbar>
						
						
			<div class="p-grid crud-demo">
				<div class="p-col-12">
					<div class="card">
						
						<p:dataTable id="dt-inventario" value="#{altaConstanciaSalidaBean.listaInventario}" var="inventario" rows="10"
									 rowKey="#{inventario.constanciaDeDeposito.folio}" paginator="true" paginatorPosition="bottom">
									 
							<p:column exportable="false" width="3%">
								<p:rowToggler/>
							</p:column>
							
							<p:column headerText="Folio Constancia De Deposito">
								<h:outputText value="#{inventario.constanciaDeDeposito.folio}" />
							</p:column>
							
							<p:column headerText="Fecha">
								<h:outputText value="#{inventario.constanciaDeDeposito.fechaIngreso}" />
							</p:column>
							
							<p:rowExpansion>
							<p:dataTable value="#{inventario.constanciaDeDeposito.partidaList}" var="partida" rowKey="#{partida.partidaCve}" rowSelectMode="add" 
											selection="#{altaConstanciaSalidaBean.partidaSelect}" selectionMode="single">
								
								<f:facet name="header">
									<div style="text-align: center;">
										<span>PARTIDAS</span>
									</div>
								</f:facet>
								
								<p:ajax event="rowSelect" />
								<p:ajax event="rowUnselect" />
								
								<p:column>
									<p:rowToggler/>
								</p:column>
								
								<p:column headerText="Folio">
									<h:outputText value="#{partida.folio.folio}" />
								</p:column>
								
								<p:column headerText="Numero">
									<h:outputText value="#{partida.unidadDeProductoCve.productoCve.numeroProd}" />
								</p:column>
								
								<p:column headerText="Producto">
									<h:outputText value="#{partida.unidadDeProductoCve.productoCve.productoDs}" />
								</p:column>
								
								<p:column headerText="Tarimas">
									<h:outputText value="#{partida.noTarimas}" />
								</p:column>
								
								<p:column headerText="Piezas">
									<h:outputText value="#{partida.cantidadTotal}" />
								</p:column>
								
								<p:column headerText="Kilos">
									<h:outputText value="#{partida.pesoTotal}" />
								</p:column>
								
								<p:column headerText="Posicion">
									<h:outputText value="#{partida.camaraCve.camaraDs}" />
								</p:column>
								
								<p:column>
									<p:commandButton value="Agregar" process="@this" icon="pi pi-plus" styleClass="ui-button-success" actionListener="#{altaConstanciaSalidaBean.saveDetalleConstanciaS()}" update="@this">
									</p:commandButton>
								</p:column> 
								
								<p:rowExpansion>
									<p:dataTable value="#{partida.detallePartidaList}" var="detalle">
										<f:facet name="header">
											<div style="text-align: center;">
												<span>DETALLE PARTIDA</span>
											</div>
										</f:facet>
									
										<p:column headerText="Codigo">
											<h:outputText value="#{detalle.dtpCodigo}" />
										</p:column>
										
										<p:column headerText="Lote">
											<h:outputText value="#{detalle.dtpLote}" />
										</p:column>
								
										<p:column headerText="Contenedor">
											<h:outputText value="#{detalle.dtpSAP}" />
										</p:column>
										
										<p:column headerText="Caducidad">
											<h:outputText value="#{detalle.dtpCaducidad}" />
										</p:column>
										
										<p:column headerText="PO">
											<h:outputText value="#{detalle.dtpPO}" />
										</p:column>
										
										<p:column headerText="MP">
											<h:outputText value="#{detalle.dtpMP}" />
										</p:column>
										
										<p:column headerText="Pedimento">
											<h:outputText value="#{detalle.dtpPedimento}" />
										</p:column>
										
										<p:column headerText="Cantidad U Manejo">
											<h:outputText value="#{detalle.cantidadUManejo}" />
										</p:column>
										
										<p:column headerText="Cantidad U Medida">
											<h:outputText value="#{detalle.cantidadUMedida}" />
										</p:column>
										
									</p:dataTable>
								</p:rowExpansion>
							</p:dataTable>
						</p:rowExpansion>
						
						</p:dataTable>
						
						
						<!-- Espacio detalleconstanciasalida -->
						<p:fieldset legend="Producto a Salir" styleClass="p-mt-4">
						<p:dataTable id="dt-detalleConstanciaSalida" value="#{altaConstanciaSalidaBean.listadoDetalleConstanciaSalida}" var="detalleCS"
									editable="true" editMode="cell">
						
						
						
						
						<p:column headerText="Temperatura">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{detalleCS.temperatura}" />
								</f:facet>								
								<f:facet name="input">
									<p:inputText id="temperatura" value="#{detalleCS.temperatura}" required="true" requiredMessage="Ingresa Temperatura">
										<p:ajax update="form:messages temperatura" event="blur" />
									</p:inputText>
								</f:facet>
							</p:cellEditor>
						</p:column>
					
						<p:column headerText="Piezas" >
							<p:cellEditor>
			                    <f:facet name="output">
			                        <h:outputText value="#{detalleCS.partidaCve.cantidadTotal}"/>
			                    </f:facet>
			                    <f:facet name="input">
			                        <p:inputText id="cantidadTotal" value="#{detalleCS.cantidad}" style="width:100%" required="true" requiredMessage="Ingresa piezas a salir">
			                        	<p:ajax update="form:messages cantidadTotal form:dt-salidas temperatura" event="blur" listener="#{altaConstanciaSalidaBean.calculoPesoSalida()}"/>
			                        </p:inputText>
			                    </f:facet>
			                </p:cellEditor>
						</p:column>
						
						<p:column headerText="Peso" >
		                        <h:outputText value="#{detalleCS.partidaCve.pesoTotal}"/>
						</p:column>
						
						</p:dataTable>
						</p:fieldset>
						
						<p:dataTable id="dt-salidas" value="#{altaConstanciaSalidaBean.listadoTemp}" var="salida">
						
						<f:facet name="header">
							<div style="text-align: center;">
								<span>DETALLE CONSTANCIA SALIDA</span>
							</div>
						</f:facet>
						
						<p:column headerText="Cantidad Total">
							<h:outputText value="#{salida.partidaCve.cantidadTotal}" />
						</p:column>
						
						<p:column headerText="Piezas a salir">
							<h:outputText value="#{salida.cantidad}" />
						</p:column>
						
						<p:column headerText="Peso de piezas a salir">
							<h:outputText value="#{salida.peso}" />
						</p:column>
						
						<p:column headerText="Temperatura">
							<h:outputText value="#{salida.temperatura}" />
						</p:column>
						
						</p:dataTable>
						
						
						<!-- Servicios -->
						<div style="margin-top: 10px;">
						
							<p:outputLabel value="Servicio:" styleClass="p-mr-2"/>
							<p:selectOneMenu id="s-servicio" autoWidth="false" converter="entityConverter" value="#{altaConstanciaSalidaBean.servicioClienteSelect}">
								<f:selectItem itemLabel="Selecciona Servicio" itemValue="" noSelectionOption="true"/>
								<f:selectItems value="#{altaConstanciaSalidaBean.serviciosCliente}" var="servicioC" itemLabel="#{servicioC.servicio.servicioDs}" itemValue="#{servicioC}"/>
								<p:ajax update="@this" />
							</p:selectOneMenu>
							
							<p:inputNumber styleClass="p-ml-4" value="#{altaConstanciaSalidaBean.cantidadServicio}">
								<p:ajax update="@this" />
							</p:inputNumber>
							
							<p:commandButton value="Agregar Servicio" icon="pi pi-plus" styleClass="p-ml-4 ui-button-success" actionListener="#{altaConstanciaSalidaBean.saveServicio()}" update="dt-servicio"></p:commandButton>
							
						</div>
						
						<p:dataTable id="dt-servicio" value="#{altaConstanciaSalidaBean.listadoConstanciaSalidaServicios}" var="constanciaServicios" >
						
							<f:facet name="header">
								<div style="text-align: center;">
									<span>SERVICIOS</span>
								</div>
							</f:facet>
						
							<p:column headerText="Servicio" >
								<h:outputText value="#{constanciaServicios.constanciaSalidaServiciosPK.servicioCve.servicioDs}" />
							</p:column>
						
							<p:column headerText="Cantidad Servicio">
							<h:outputText value="#{constanciaServicios.numCantidad}" />
							</p:column>
						
						</p:dataTable>
						
						
						<div style="margin-top: 5px">
							<p:outputLabel value="Nombre del Transportista:" styleClass="p-mr-2" />
							<p:inputText value="#{altaConstanciaSalidaBean.nombreTransportista}"/>
							
							<p:outputLabel value="Placas del Transporte:" styleClass="p-ml-4" />
							<p:inputText styleClass="p-ml-2" value="#{altaConstanciaSalidaBean.placas}"/>
							
							<p:outputLabel value="Observaciones:" styleClass="p-mr-2 p-ml-4" />
							<p:inputTextarea autoResize="true" value="#{altaConstanciaSalidaBean.observaciones}"></p:inputTextarea>
						</div>
						
						<p:toolbar styleClass="p-mt-3">
							<p:toolbarGroup>
								<p:splitButton value="Guardar" styleClass="ui-button-success" actionListener="#{altaConstanciaSalidaBean.saveDetalleConstanciaSalida()}" icon="pi pi-save" update="@this">
									<p:menuitem value="Ticket" icon="pi pi-print" actionListener="#{altaConstanciaSalidaBean.imprimirTicket()}" ajax="false"/>
									<p:menuitem value="Nuevo" icon="pi pi-refresh" actionListener="#{altaConstanciaSalidaBean.nuevoRegistro()}" update="@form"/>
								</p:splitButton>
							</p:toolbarGroup>
						</p:toolbar>
						
					</div>
				</div>
			</div>
		</h:form>
	</ui:define>
</ui:composition>