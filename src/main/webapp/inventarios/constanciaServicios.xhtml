<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/template.xhtml">

	<ui:define name="title">Constancia de Servicio</ui:define>

	<ui:define name="content">
		<h:form id="form">
			<p:breadCrumb>
				<p:menuitem value="Home" outcome="/dashboard" />
				<p:menuitem value="Inventarios" />
				<p:menuitem value="Servicios" />
				<p:menuitem value="Consultar"
					outcome="/inventarios/constanciaServicios" />
			</p:breadCrumb>
			<div class="p-grid crud-demo">
				<div class="p-col-12">
					<div class="card">
						
						<p:outputLabel value="Por Rango de Fechas:" />
						<p:datePicker id="fechaInicial" showIcon="true"
							styleClass="p-mr-4 p-mb-2" placeholder="Fecha de Inicio"
							value="#{constanciaServicioBean.fechaInicio}" />
						<p:datePicker id="fechaFinal" showIcon="true"
							styleClass="p-mr-4 p-mb-2" placeholder="Fecha Final"
							value="#{constanciaServicioBean.fechaFinal}" />
						
						<p:outputLabel for="folio" value="Por Folio:" />
						<p:inputText id="folio" value="#{constanciaServicioBean.folio}"/>
						
						<p:outputLabel for="cliente-som" value="Por Clientes:" />
						<p:selectOneMenu id="cliente-som" autoWidth="false"
							value="#{constanciaServicioBean.idCliente}" filter="true"
							filterMatchMode="startsWith">
							<f:selectItem itemLabel="Selecione Cliente" itemValue=""
								noSelectionOption="true" />
							<f:selectItems var="selectedCliente"
								value="#{constanciaServicioBean.listaClientes}"
								itemLabel="#{selectedCliente.cteNombre}"
								itemValue="#{selectedCliente.cteCve}" />
						</p:selectOneMenu>
						<p:commandButton value="Consultar" styleClass="p-mr-2 p-mb-2"
							icon="pi pi-fw pi-search"
							actionListener="#{constanciaServicioBean.buscarConstancia}"
							update="@widgetVar(dtConstanciaServicios)"/>
					</div>
				</div>
			</div>

			<div class="p-grid crud-demo">
				<div class="p-col-12">
					<div class="card">
						<p:growl id="messages" showDetail="true" />
						<p:dataTable
							id="dt-constanciaServicios"
							widgetVar="dtConstanciaServicios"
							var="constancia"
							reflow="true"
							selection="#{constanciaServicioBean.seleccion}"
							rowKey="#{constancia.folio}"
							value="#{constanciaServicioBean.listaConstanciaServicios}"
							paginator="true"
							rows="10"
							rowSelectMode="add"
							selectionMode="single"
							paginatorPosition="bottom">
							<f:facet name="header">
								<div class="customers-table-header">
									<span style="font-weight: bold">Constancias de Servicio</span>
									
									<span class="ui-input-icon-left filter-container">
										<i class="pi pi-search"></i>
										<p:inputText id="globalFilter" onkeyup="PF('dtConstanciaServicios').filter()" placeholder="BÃºsqueda" />
									</span>
								</div>
							</f:facet>
							
							
							<p:column headerText="Folio" sortBy="#{constancia.folioCliente}"
								filterBy="#{constancia.folioCliente}" width="5rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem"
									value="#{constancia.folioCliente}" />
							</p:column>
							<p:column headerText="Cliente" sortBy="#{constancia.cteCve.cteNombre}"
								filterBy="#{constancia.cteCve.cteNombre}">
								<h:outputText style="vertical-align: middle; margin-left: .5rem"
									value="#{constancia.cteCve.cteNombre}" />
							</p:column>
							<p:column headerText="Fecha" sortBy="#{constancia.fecha}"
								filterBy="#{constancia.fecha}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem"
									value="#{constancia.fecha}" />
							</p:column>
							<p:column headerText="Estado" sortBy="#{constancia.status.descripcion}"
								filterBy="#{constancia.status.descripcion}" width="7rem">
								<h:outputText style="vertical-align: middle; margin-left: .5rem"
									value="#{constancia.status.descripcion}" />
							</p:column>
							<p:column width="10rem">
								<p:commandButton update=":form:constanciaDetalle" oncomplete="PF('dlg-constancia').show()"
									icon="pi pi-search" value="Ver detalle" styleClass="edit-button ui-button-info">
									<f:setPropertyActionListener value="#{constancia}" target="#{constanciaServicioBean.seleccion}"/>
								</p:commandButton>
								<!-- <p:commandButton icon="pi pi-pencil" update=":form:constanciaDetalle" value="Detalle"  process="@this">
									<f:setPropertyActionListener value="#{constancia}" target="#{constanciaServicioBean.seleccion}"></f:setPropertyActionListener>
								</p:commandButton> -->
							</p:column>
						</p:dataTable>
						
						<p:dialog header="Constancia de servicio" showEffect="fade" modal="true" widgetVar="dlg-constancia" responsive="true" style="max-width:80em !important;" resizable="true">
							<p:outputPanel id="constanciaDetalle" class="ui-fluid">
								<p:outputPanel rendered="#{not empty constanciaServicioBean.seleccion}">
									<div class="p-grid">
										<div class="p-col-12 p-md-6 p-lg-4" style="width: 10em;">
											<p:outputLabel for="@next">Folio:</p:outputLabel>
											<p:inputText value="#{constanciaServicioBean.seleccion.folioCliente}"/>
										</div>
										<div class="p-col-12 p-md-6 p-lg-4" style="width: 10em;">
											<p:outputLabel>Fecha:</p:outputLabel>
											<p:datePicker id="fechaServicio" showIcon="true" 
												styleClass="p-mr-4 p-mb-2" value="#{constanciaServicioBean.seleccion.fecha}"/>
										</div>
										<div class="p-col-12 p-md-6 p-lg-4" style="width: 40em;">
											<p:outputLabel for="@next">Cliente</p:outputLabel>
											<p:inputText value="#{constanciaServicioBean.seleccion.cteCve.cteNombre}"  />
										</div>
										<div class="p-col-12 p-md-6 p-lg-4" style="width: 10em;">
											<p:outputLabel>Estado</p:outputLabel>
											<p:inputText value="#{constanciaServicioBean.seleccion.status.descripcion}"></p:inputText>
										</div>
									</div>
									<div class="p-grid">
										<div class="p-col-12 p-md-6 p-lg-4" style="width: 15em;">
											<p:outputLabel for="@next">Nombre del transportista</p:outputLabel>
											<p:inputText value="#{constanciaServicioBean.seleccion.nombreTransportista}"/>
										</div>
										<div class="p-col-12 p-md-6 p-lg-4" style="width: 10em;">
											<p:outputLabel for="@next">Placas del vehiculo</p:outputLabel>
											<p:inputText value="#{constanciaServicioBean.seleccion.placasTransporte}"/>
										</div>
										<div class="p-col-12 p-md-6 p-lg-4" style="width: 40em;">
											<p:outputLabel>Observaciones</p:outputLabel>
											<p:inputText value="#{constanciaServicioBean.seleccion.observaciones}" />
										</div>
									</div>
									<p:dataTable
											value="#{constanciaServicioBean.seleccion.partidaServicioList}"
											var="partida"
											scrollable="true"
											scrollHeight="6em"
											scrollRows="2"
											rendered="#{not empty constanciaServicioBean.seleccion.partidaServicioList}">
											<p:column headerText="Cantidad" width="10em">
												<h:outputText value="#{partida.cantidadTotal}" />
											</p:column>
											<p:column headerText="Unidad">
												<h:outputText value="#{partida.unidadDeManejoCve.unidadDeManejoDs}" />
											</p:column>
											<p:column headerText="Producto">
												<h:outputText value="#{partida.productoCve.productoDs}" />
											</p:column>
											<p:column headerText="Peso (kg)">
												<h:outputText value="#{partida.cantidadDeCobro}" />
											</p:column>
										</p:dataTable>
										<p:dataTable
											value="#{constanciaServicioBean.seleccion.constanciaServicioDetalleList}"
											var="servicio"
											scrollable="true"
											scrollHeight="6em"
											scrollRows="2"
											rendered="#{not empty constanciaServicioBean.seleccion.constanciaServicioDetalleList}">
											<p:column headerText="Servicio">
												<h:outputText value="#{servicio.servicioCve.servicioDs}" />
											</p:column>
											<p:column headerText="Cantidad">
												<h:outputText value="#{servicio.servicioCantidad}" />
											</p:column>
										</p:dataTable>
								</p:outputPanel>
							</p:outputPanel>
							<f:facet name="footer">
								<p:commandButton value="Cancelar Constancia" icon="pi pi-trash"
									class="ui-button-danger"
									actionListener="#{constanciaServicioBean.cancelar}"
									update="constanciaDetalle"
									process="constanciaDetalle @this" rendered="#{(constanciaServicioBean.usuario.perfil != 4) and (constanciaServicioBean.usuario.perfil != 1)}"/>
								<p:commandButton value="Cerrar" icon="pi pi-times"
									oncomplete="PF('dlg-constancia').hide()" />
							</f:facet>
						</p:dialog>
					</div>
				</div>
			</div>
			
			
		</h:form>

	</ui:define>

</ui:composition>