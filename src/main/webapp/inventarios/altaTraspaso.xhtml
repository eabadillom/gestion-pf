<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="title">Alta Traspaso de Servicio</ui:define>
	<ui:define name="content">
		<h:form id="form">
			<p:breadCrumb>
				<p:menuitem value="Home" outcome="/dashboard" />
				<p:menuitem value="Traspasos" />
				<p:menuitem value="Alta" />
				<p:menuitem value="Alta" outcome="/inventarios/altaTraspaso" />
			</p:breadCrumb>
			<p:growl id="messages" showDetail="true" />
						<p:datePicker id="fecha" showIcon="true" styleClass="p-mr-4 p-mb-2" placeholder="Fecha" disabled="true" value="#{altaTraspasoBean.fecha}" />
							<p:inputText id="txtFolio" value="#{altaTraspasoBean.numero}" placeholder="Folio" />
			<p:toolbar>
				<p:toolbarGroup>
						<p:selectOneMenu id="Cliente" autoWidth="true" value="#{altaTraspasoBean.idCliente}" filterMatchMode="startsWith">
							<f:selectItem itemLabel="Seleccione Cliente" itemValue="" noSelectionOption="true" />
							<f:selectItems var="cte" value="#{altaTraspasoBean.clientes}" itemLabel="#{cte.cteNombre}" itemValue="#{cte.cteCve}" />
							<p:ajax listener="#{altaTraspasoBean.filtrarCliente}" process="@this" update=":form:traspaso :form:selServicio :form:txtplantadestino :form:camaradestino :form:posiciondestino"/>
						</p:selectOneMenu>
				</p:toolbarGroup>
			</p:toolbar>
	<h5></h5>
         <div class="card">
		<p:dataTable id="traspaso" var="inventario" value="#{altaTraspasoBean.inventario}" reflow="true" rowKey="#{inventario.folioCliente}"
			paginator="true" rows="10" rowSelectMode="add" paginatorPosition="bottom">           
            <p:column style="width:2rem"><p:rowToggler/></p:column>
            <p:column headerText="Folio" sortBy="#{inventario.constanciaDepo.folio}" ><h:outputText value="#{inventario.folioCliente}" /></p:column>

            <p:column headerText="Producto" sortBy="#{inventario.producto.productoDs}" >
                <h:outputText value="#{inventario.producto.productoDs}"  />
            </p:column>
            <p:column headerText="Cantidad" ><h:outputText value="#{inventario.cantidad}" /></p:column>
            <p:column headerText="Camara" ><h:outputText value="#{inventario.camara.camaraDs}" /></p:column>
            <p:column headerText="Unidad de Manejo" ><h:outputText value="#{inventario.unidadManejo.unidadDeManejoDs}" /></p:column>
            <p:column headerText="Planta origen" ><h:outputText value="#{inventario.planta.plantaDs}" /></p:column>						   
	<!-- Comienza lista desplegable -->
	
            <p:rowExpansion>
            <div class="p-grid ui-fluid">
				<div class="p-field p-col-2 p-md-2">
					
					<p:outputLabel for="@next" value="Código" /><p:inputText value="#{inventario.codigo}" readonly="true" />
				</div>
				<div class="p-field p-col-2 p-md-2">
					<p:outputLabel for="@next" value="Caducidad"/><p:inputText value="#{inventario.caducidad}" readonly="true"/>
				</div>
				<div class="p-field p-col-2 p-md-2">
					<p:outputLabel for="@next" value="Lote"/><p:inputText value="#{inventario.lote}" readonly="true" />
				</div>
					<div class="p-field p-col-2 p-md-2">
					<p:outputLabel for="@next" value="SAP"/><p:inputText value="#{inventario.sap}" readonly="true" />
				</div>
				<div class="p-field p-col-2 p-md-2">
					<p:outputLabel for="@next" value="Peso"/><p:inputText value="#{inventario.peso}" readonly="true" />
				</div>
					<div class="p-field p-col-2 p-md-2">
					
					<p:outputLabel align="center">Accion</p:outputLabel>
				   <p:commandButton icon="pi pi-plus" update=":form:pnlCliente" value="Traspasar" oncomplete="PF('dialogCliente').show();" styleClass="ui-button-raised" process="@this" >
				   <f:setPropertyActionListener value="#{inventario}" target="#{altaTraspasoBean.selectedInventario}" />
				   </p:commandButton>
						</div>
					</div>    
			</p:rowExpansion>
         </p:dataTable>
         </div>
         
         
 	<p:dialog header="Confirmar detalles" showEffect="fade" modal="true" widgetVar="dialogCliente" responsive="true">
			<p:outputPanel id="pnlCliente" class="ui-fluid" >
			<p:outputPanel rendered="#{not empty altaTraspasoBean.inventario}">                  
                 
                 <div class="card" style="width: 100%">
			        <div class="grid ui-fluid mt-3 floatlabel-demo">
			            <div class="col-12 md:col-6">
			             <p:panelGrid columns="3" >
			             
			             <p:panel id="Nombre">
			                <div class="field">              
			                    <p:outputLabel for="@next" value="Cliente" />
			                    <p:inputText value="#{altaTraspasoBean.selectedInventario.cliente.cteNombre}" readonly="true" />
			                </div>
			            </p:panel>
			            
            			<p:panel id="Cantidad">
			                <div class="field">              
			                    <p:outputLabel for="cantidad-new" value="Cantidad" />
			                    <p:inputText widgetVar="cantidad-new" id="cantidad-new" value="#{altaTraspasoBean.selectedInventario.cantidad}" readonly="true" />
			                </div>
			            </p:panel>
                
              			<p:panel id="unidadM">
			                <div class="field">              
			                    <p:outputLabel for="unidadM" value="Unidad de Manejo" />
			                    <p:inputText widgetVar="unidadM-new" id="unidadM-new" value="#{altaTraspasoBean.selectedInventario.unidadManejo.unidadDeManejoDs}" readonly="true" />
			                </div>
			            </p:panel>
                
                 		<p:panel id="Peso">
			                <div class="field">              
			                    <p:outputLabel for="peso-new" value="Peso" />
			                    <p:inputText widgetVar="peso-new" id="peso-new" value="#{altaTraspasoBean.selectedInventario.peso}" readonly="true" />
			                </div>
			            </p:panel>
                  
                <p:panel id="planta">
                <div class="field">
                        <p:outputLabel for="planta" value="Planta destino" />
                       <p:selectOneMenu id="txtplantadestino" value="#{altaTraspasoBean.selectedInventario.plantaDestino}" converter="entityConverter" >
						<f:selectItem itemLabel="--Planta--" itemValue=""  />
						<f:selectItems value="#{altaTraspasoBean.selectedInventario.listaplanta}" var="planta" itemLabel="#{planta.plantaDs}" itemValue="#{planta}" />
						<p:ajax listener="#{altaTraspasoBean.plantaselect}" process="@this" update=":form:camaradestino"/>						
						</p:selectOneMenu>
                </div>
                </p:panel>
                
                <p:panel id="Camara">
                <div class="field">
                        <p:outputLabel for="camaradestino" value="Camara destino" />
				<p:selectOneMenu id="camaradestino" value="#{altaTraspasoBean.selectedInventario.camaraDestino}" converter="entityConverter" >
				<f:selectItem itemLabel="--Camara--" itemValue=""  />
				<f:selectItems value="#{altaTraspasoBean.selectedInventario.listacamara}" var="camaradestino" itemLabel="#{camaradestino.camaraDs}" itemValue="#{camaradestino}" />
				<p:ajax listener="#{altaTraspasoBean.camaraselect}" process="@this" update=":form:posiciondestino"/>						
				</p:selectOneMenu>
                </div>
                </p:panel>
                
                <p:panel id="Posicion">
                <div class="field">
                <p:outputLabel for="posiciondestino" value="Posicion destino" />
                <p:selectOneMenu id="posiciondestino" value="#{altaTraspasoBean.selectedInventario.posicionDestPosicion}" converter="entityConverter" >
				<f:selectItem itemLabel="--Posicion--" itemValue=""  />
				<f:selectItems value="#{altaTraspasoBean.selectedInventario.listaposicion}" var="posiciondestino" itemLabel="#{posiciondestino.idPosicion}" itemValue="#{posiciondestino}" />
				<p:ajax /></p:selectOneMenu>
                </div>
                </p:panel>
                					</p:panelGrid>
						            </div>
						        </div>
							</div>
							</p:outputPanel>
							</p:outputPanel>
						<f:facet name="footer">
				<p:commandButton value="Añadir" icon="pi pi-check" actionListener="#{altaTraspasoBean.agrega()}" update="destino" oncomplete="PF('dialogCliente').hide()"/>
				<p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('dialogCliente').hide();" class="ui-button-secondary" ></p:commandButton>
					</f:facet>
						</p:dialog>
         <p:divider align="left"><div class="inline-flex align-items-center"><i class="pi pi-shopping-cart"/>
			<b>Destino</b>
		 </div></p:divider>
        <p:toolbar>
            <p:toolbarGroup>

			
            <p:dataTable id="destino" var="partida" value="#{altaTraspasoBean.inventario}" reflow="true" rowKey="#{altaTraspasoBean.selectedInventario}"  scrollable="true" scrollHeight="9em" scrollRows="4" >
				<p:column headerText="Folio" width="8em"><h:outputText value="#{partida.folioCliente}"/></p:column>
				<p:column headerText="En existencia" width="10em"><h:outputText value="#{partida.cantidad}" /></p:column>
				<p:column headerText="Unidad de Manejo" width="8em"><h:outputText value="#{partida.unidadManejo.unidadDeManejoDs}"/></p:column>
				<p:column headerText="Kilos" width="10em"><h:outputText value="#{partida.peso}"/></p:column>
				<p:column headerText="Producto" width="8em"><h:outputText value="#{partida.producto.productoDs}"/></p:column>
				<p:column headerText="Camara Origen" width="10em"><h:outputText value="#{partida.camara.camaraDs}"/></p:column>
				<p:column headerText="Planta origen" width="8em"><h:outputText value="#{partida.planta.plantaDs}"/></p:column>
				<p:column headerText="Posicion Origen" width="10em"><h:outputText value="#{partida.posicion.idPosicion}"/></p:column>
				<p:column headerText="Camara destinada" width="10em"><h:outputText value="#{partida.camara.camaraDs}"/></p:column>
				<p:column headerText="Planta destinada" width="10em"><h:outputText value="#{partida.planta.plantaDs}"/></p:column>
				<p:column headerText="Posicion destinada" width="10em"><h:outputText value="#{partida.posicion.idPosicion}"/></p:column>
				
				<p:column width="8em">
				<p:commandButton icon="pi pi-times" styleClass="ui-button-info p-mr-2 p-mb-2" actionListener="#{altatraspasoBean.deletePartida(partida)}" update="destino" />
				</p:column>
			</p:dataTable>
            </p:toolbarGroup>
		</p:toolbar>			
		<p:fieldset legend="Tipo de Servicio">
		<p:panel>	
				<p:selectOneMenu id="selServicio" autoWidth="true" value="#{altaTraspasoBean.idPrecioServicio}" filterMatchMode="startsWith">
					<f:selectItem itemLabel="Seleccione Servicio" itemValue="" noSelectionOption="true" />
					<f:selectItems var="selectedPrecioServicio" value="#{altaTraspasoBean.alServicios}"
						itemLabel="#{selectedPrecioServicio.servicio.servicioDs} (#{selectedPrecioServicio.unidad.unidadDeManejoDs})" itemValue="#{selectedPrecioServicio.id}" />
				</p:selectOneMenu>
				<p:column><p:inputNumber id="txtCantidadSrv" value="#{altaTraspasoBean.cantidadServicio}" placeholder="Cantidad" minValue="1" decimalPlaces="0" style="width: 6em;"/></p:column>
				<p:column>
				<p:commandButton value="Agregar" icon="pi pi-plus" styleClass="ui-button-info p-mr-2 p-mb-2" actionListener="#{altaTraspasoBean.agregarServicio}" update="dtServicios"/>
				</p:column>
				</p:panel>
			<p:dataTable id="dtServicios"	var="servicio" selection="#{altaTraspasoBean.selServicio}" value="#{altaTraspasoBean.alServiciosDetalle}" scrollable="true" scrollHeight="9em" 
							scrollRows="2" reflow="true">	
				<p:column headerText="Servicio seleccionado" width="8em"><h:outputText value="#{servicio.servicioCve.servicioDs}" /></p:column>
				<p:column headerText="Cantidad" width="10em"><h:outputText value="#{servicio.servicioCantidad}" /></p:column>
				<p:column width="8em">
					<p:commandButton icon="pi pi-times" styleClass="ui-button-info p-mr-2 p-mb-2" actionListener="#{altaTraspasoBean.deleteServicio(servicio)}" update="dtServicios"/>
				</p:column>
			</p:dataTable>
		</p:fieldset>				
					
		<div class="field col-12 md:col-4">
			<p:panel><p:inputTextarea rows="3" cols="30" id="txtObservaciones" value="#{altaTraspasoBean.observaciones}" placeholder="Observaciones." style="width: 30em;"/></p:panel>
		</div>
		<div>
			
        <p:splitButton value="Confirmar Traspaso" actionListener="#{altaTraspasoBean.guardar}" icon="pi pi-save">
            <p:menuitem value="Generar reporte" actionListener="#{altaTraspasoBean.jasper}" icon="pi pi-file-pdf" ajax="false" process="@this"/>
            <p:menuitem value="Limpiar" action="#{altatraspasoBean.reload}" update="messages" icon="pi pi-times"/>
        </p:splitButton>
		</div>
 

		</h:form>
	</ui:define>
</ui:composition>