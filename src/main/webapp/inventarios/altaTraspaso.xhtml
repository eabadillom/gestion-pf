<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="title">Alta Constancia de Servicio</ui:define>
	<ui:define name="content">
		<h:form id="form">
			<p:breadCrumb>
				<p:menuitem value="Home" outcome="/dashboard" />
				<p:menuitem value="Traspasos" />
				<p:menuitem value="Alta" />
				<p:menuitem value="Alta" outcome="/inventarios/altaTraspaso" />
			</p:breadCrumb>
			<p:growl id="messages" showDetail="true" />
						<p:datePicker id="fecha" showIcon="true" styleClass="p-mr-4 p-mb-2" placeholder="Fecha" disabled="true" value="#{altaTraspasoBean.fecha}" />
							<p:inputText id="txtFolio" value="#{altaTraspasoBean.numero}" placeholder="Folio" />
			<p:toolbar>
				<p:toolbarGroup>
						<p:selectOneMenu id="Cliente" autoWidth="true" value="#{altaTraspasoBean.idCliente}" filterMatchMode="startsWith">
							<f:selectItem itemLabel="Seleccione Cliente" itemValue="" noSelectionOption="true" />
							<f:selectItems var="cte" value="#{altaTraspasoBean.clientes}" itemLabel="#{cte.cteNombre}" itemValue="#{cte.cteCve}" />
							<p:ajax listener="#{altaTraspasoBean.filtrarCliente}" process="@this" update=":form:traspaso "/>
						</p:selectOneMenu>
						
				</p:toolbarGroup>
			</p:toolbar>
	<h5></h5>
<div class="card crud-demo">
    <h:form id="form">
        <p:growl id="messages" showDetail="true" />
            
         <div class="card"><h:form>
		<p:dataTable id="traspaso" var="altatraspaso" value="#{altaTraspasoBean.inventario}" reflow="true" rowKey="#{altatraspaso.folio}" styleClass="products-table"
			paginator="true" rows="10" rowSelectMode="add" paginatorPosition="bottom">           
            <p:column style="width:2rem"><p:rowToggler/></p:column>
            <p:column headerText="Folio" sortBy="#{altatraspaso.folio.folio}" filterBy="#{altatraspaso.folio.folio}"><h:outputText value="#{altatraspaso.folio.folio}" /></p:column>
            <p:column headerText="Producto" sortBy="#{altatraspaso.productoCve.productoDs}" filterBy="#{altatraspaso.productoCve.productoDs}">
                <h:outputText value="#{altatraspaso.productoCve.productoDs}"  />
            </p:column>
            <p:column headerText="Cantidad" sortBy="#{altatraspaso.cantidadTotal}" filterBy="#{altatraspaso.cantidadTotal}"><h:outputText value="#{altatraspaso.cantidadTotal}" /></p:column>
            <p:column headerText="Unidad de Manejo" ><h:outputText value="#{altatraspaso.unidadDeManejoCve.unidadDeManejoDs}" /></p:column>
            <p:column headerText="Planta origen" ><h:outputText value="" /></p:column>
            <p:column headerText="Posicion Origen" ><h:outputText value="#{altatraspaso.cantidadTotal}" /></p:column>
						   
	<!-- Comienza lista desplegable -->
            <p:rowExpansion>
            <p:dataTable id="row-constancia" widgetVar="dt-constancia" var="rconstancia" value="#{altaTraspasoBean.ldpartida}" reflow="true" rowKey="#{rconstancia.partidaCve}" 
            		styleClass="products-table" rows="5" paginatorPosition="bottom" >
							<p:column headerText="Caducidad"><h:outputText value="#{rconstancia.dtpCaducidad}" /></p:column>
							<p:column headerText="Codigo"><h:outputText value="#{rconstancia.dtpCodigo}" /></p:column>
							<p:column headerText="Lote"><h:outputText value="#{rconstancia.dtpLote}" /></p:column>
							<p:column headerText="SAP"><h:outputText value="#{rconstancia.cantidadTotal}" /></p:column>
							<p:column headerText="Planta destino"><h:outputText value="#{rconstancia.cantidadTotal}" />
								<p:selectOneMenu id="txtplantadestino" value="" converter="entityConverter" >
								<f:selectItem itemLabel="---Seleccione---" itemValue=""  />
								<f:selectItems value="" var="user" itemLabel="#{user}" itemValue="#{user}" />
								<p:ajax />
								</p:selectOneMenu>
							</p:column>
							<p:column headerText="Camara destino">
								<p:selectOneMenu id="camaradestino" value="#{altatraspaso.productoCve.productoDs}" converter="entityConverter" >
								<f:selectItem itemLabel="---Seleccione---" itemValue=""  />
								<f:selectItems value="" var="user" itemLabel="#{user}" itemValue="#{user}" />
								<p:ajax />
								</p:selectOneMenu>
							</p:column>
							<p:column headerText="Posicion destino">
								<p:selectOneMenu id="posiciondestino" value="#{altatraspaso.productoCve.productoDs}" converter="entityConverter" >
								<f:selectItem itemLabel="---Seleccione---" itemValue=""  />
								<f:selectItems value="" var="user" itemLabel="#{user}" itemValue="#{user}" />
								<p:ajax />
								</p:selectOneMenu>
							</p:column>
            </p:dataTable>
            	  <p:divider align="left">
			        <div class="inline-flex align-items-center">
			            <i class="pi pi-user mr-2"/>
			            <b>Servicios de cobro para este traspaso</b>
			        </div>
			    </p:divider>
								<b>Tipo de servicio</b>
				<p:selectOneMenu id="selServicio" autoWidth="true" value="#{altaTraspasoBean.idPrecioServicio}" filterMatchMode="startsWith">
					<f:selectItem itemLabel="Seleccione Servicio" itemValue="" noSelectionOption="true" />
					<f:selectItems var="selectedPrecioServicio" value="#{altaTraspasoBean.alServicios}" itemLabel="#{selectedPrecioServicio.servicio.servicioDs} 
									(#{selectedPrecioServicio.unidad.unidadDeManejoDs})" itemValue="#{selectedPrecioServicio.id}" />
				</p:selectOneMenu>
							<b>    </b>
							<p:column headerText="cantidadservicio"><p:inputText id="cantidad" value="" placeholder="Cantidad." /></p:column>
							<div class="p-grid ui-fluid">
						 		<div class="p-field p-col-2 p-md-2">
                           <p:commandButton value="Traspasar" styleClass="ui-button-raised" icon="pi pi-plus" disabled="#{product.inventoryStatus == 'OUTOFSTOCK'}"/>
                           <span class="product-badge status-#{product.inventoryStatus.name().toLowerCase()}">#{product.inventoryStatus.text}</span>
								</div>
							</div>
			</p:rowExpansion>
         </p:dataTable>
         </h:form>
         </div>
         
         
        <p:toolbar>
            <p:toolbarGroup>
            <p:dataTable id="dt-servicio" var="serviciosExtras" selection="#{altaConstanciaServicioBean.selPartida}" value="#{altaTraspasoBean.partida}" scrollable="true" scrollHeight="9em" scrollRows="4" reflow="true">
				<p:column headerText="Descripcion" width="8em"><h:outputText value="#{partida.cantidadTotal}"/></p:column>
				<p:column headerText="Cantidad" width="10em"><h:outputText value="#{partida.unidadDeManejoCve.unidadDeManejoDs}" /></p:column>
				<p:column headerText="Origen" width="8em"><h:outputText value="#{partida.productoCve.productoDs}"/></p:column>
				<p:column headerText="Destino" width="10em"><h:outputText value="#{partida.cantidadDeCobro}"/></p:column>
				<p:column headerText="Cantidad" width="10em"><h:outputText value="#{partida.cantidadDeCobro}"/></p:column>
				<p:column headerText="Precio" width="10em"><h:outputText value="#{partida.cantidadDeCobro}"/></p:column>
				<p:column headerText="Subtotal" width="10em"><h:outputText value="#{partida.cantidadDeCobro}"/></p:column>
				<p:column width="8em">
				<p:commandButton icon="pi pi-times" styleClass="ui-button-info p-mr-2 p-mb-2" actionListener="#{altatraspasoBean.deletePartida(partida)}" update="dt-servicio"/>
				</p:column>
			</p:dataTable>
            </p:toolbarGroup>
		</p:toolbar>
					<p:fieldset legend="Valor declarado">
					<div class="field col-12 md:col-4">
					<p:panel><p:inputTextarea rows="3" cols="30" id="txtObservaciones" value="#{altaConstanciaServicioBean.observaciones}" placeholder="Observaciones." style="width: 30em;"/></p:panel>
				</div>			
			<div>
        <p:splitButton value="Confirmar Traspaso" actionListener="#{altaConstanciaServicioBean.guardar}" icon="pi pi-save">
            <p:menuitem value="Generar reporte" actionListener="#{altaConstanciaServicioBean.jasper}" icon="pi pi-file-pdf" ajax="false" process="@this"/>
            <p:menuitem value="Limpiar" action="#{altaConstanciaServicioBean.reload}" update="messages" icon="pi pi-times"/>
        </p:splitButton>
		</div>
		</p:fieldset>
    </h:form>
</div>
		</h:form>
	</ui:define>
</ui:composition>