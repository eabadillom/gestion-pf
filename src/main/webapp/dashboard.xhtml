<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">
    <ui:define name="title">Resumen de Venta por año</ui:define>
    <ui:define name="content">
        <style type="text/css">
            .green {
                background-color: #a5e594 !important;
                background-image: none !important;
                color: #11971f !important;
                padding: 15px;
                border-radius: 5px 5px 5px 5px;
                font-weight: bold;
            }

            .red {
                background-color: #e99989 !important;
                background-image: none !important;
                color: #922b21 !important;
                padding: 15px;
                border-radius: 5px 5px 5px 5px;
                font-weight: bold;
            }
        </style>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
        <script type="text/javascript">
            function charOcupacionCamaraExtender(){
                var options = {
                    options: {
                        plugins:{
                            title: {
                            display: false,
                            text: "title set from JavaScript"

                        },legend:{
                            display: true
                        },
                        datalabels:{
                            rotation: 90,
                            font: 'bold 20px sans-serif',
                            formatter: function(value, context) {
                                return value.toLocaleString('es-MX'); // 1200
                            }
                        }

                        }, scales:{
                            y: {
                                beginAtZero: true
                            }
                        }
                    },plugins: [ChartDataLabels]
                };

                //merge all options into to main chart options
                $.extend(true, this.cfg.config, options);
                };
            
            function charExtender() {
                var options = {
                    options: {
                        plugins:{
                            title: {
                            display: false,
                            text: "title set from JavaScript"

                        },legend:{
                            display: true
                        },
                        datalabels:{
                            rotation: 90,
                            font: 'bold 20px sans-serif',
                            formatter: function(value, context) {
                                return '$' + value.toLocaleString('es-MX'); // 1200
                            }
                        }

                        }, scales:{
                            y: {
                                beginAtZero: true
                            }
                        }
                    },plugins: [ChartDataLabels]
                };

                //merge all options into to main chart options
                $.extend(true, this.cfg.config, options);
                };

            function charExtenderDonut() {
                var options = {
                    options: {
                        plugins: {
                            title: {
                                display: false,
                                text: "title set from JavaScript"

                            }, legend: {
                                display: true
                            },
                            datalabels: {
                                font: 'bold 16px sans-serif',
                                formatter: function (value, context) {
                                    return '$' + value.toLocaleString('es-MX'); // 1200
                                }
                            }


                        }, scales: {

                            y: {
                                beginAtZero: false

                            }
                        }
                    }, plugins: [ChartDataLabels]
                };

                //merge all options into to main chart options
                $.extend(true, this.cfg.config, options);
            };

        </script>
        <h:form id="form">
            <div class="p-grid p-fluid p-mb-4">
                <div class="col-12 md:6">
                    <p:barChart model="#{dashboardBean.stackedGroupBarModel}" style="width: 100%; height: 400px;"
                        rendered="#{(sideBarBean.usuario.perfil != 1) and (sideBarBean.usuario.perfil != 4)}" />
                </div>

                <div class="col-12 md:6">
                    <p:barChart model="#{dashboardBean.modelCamara}" style="width: 100%; height: 400px;" />
                </div>
            </div>
            
            <p:fieldset legend="Periodo De Pago" styleClass="p-mt-4 p-mb-2">
                <div class="p-grid p-ai-center p-gap-2">
                    <div class="p-col-12 p-md-2">
                        <p:datePicker id="yearMonth" view="month" value="#{dashboardBean.mesActual}" pattern="MM/yyyy" yearNavigator="true" 
                            yearRange="2000:2050" maxdate="#{dashboardBean.maxDate}">
                            <p:ajax listener="#{dashboardBean.VentaDia()}" update="dt-ventas @this" />
                        </p:datePicker>
                    </div>
                    
                    <div class="p-col-12 p-md-6">
                        <p:commandButton value="Mostrar Detalle" styleClass="w-full md:w-auto" oncomplete="PF('dlgDesglose').show()" 
                                     action="#{dashboardBean.readerList()}" process="form:yearMonth @this" update="form:dlg-Desglose form:yearMonth" />
                    </div>
                </div>
            </p:fieldset>
            
            <p:panel header="Ventas por Mes" styleClass="p-mb-3">
                <p:dataTable id="dt-ventas" widgetVar="dtVentas" var="ventas" value="#{dashboardBean.listaVentaDia}" reflow="true" paginator="false"
                             rowSelectMode="add" scrollable="true" scrollHeight="400" style="width:100%">

                    <p:column headerText="Fecha" style="text-align:center; white-space:nowrap;">
                        <h:outputText value="#{ventas.fecha}" />
                    </p:column>

                    <p:column headerText="Facturación al día" style="text-align:center">
                        <h:outputText value="#{ventas.total_facturacion}">
                            <f:convertNumber currencySymbol="$" type="currency" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Mes VS Mes" style="text-align:center">
                        <h:outputText value="#{ventas.porcentaje} %" styleClass="#{(ventas.porcentaje ge 0 ? 'green' : (ventas.porcentaje lt 0 ? 'red' : null))}" />
                    </p:column>

                    <p:column headerText="Pendiente por cobrar (factura)" style="text-align:center">
                        <h:outputText value="#{ventas.total_facturacion}">
                            <f:convertNumber currencySymbol="$" type="currency" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Pendiente por cobrar (efectivo)" style="text-align:center">
                        <h:outputText value="#{ventas.total_por_efectivo}" />
                    </p:column>

                </p:dataTable>

            </p:panel>
            
            <p:dialog id="dlg-Desglose" widgetVar="dlgDesglose" modal="true" responsive="true" style="max-width:95vw !important; width:95vw;" appendTo="@(body)">
                <p:outputPanel style="overflow-x:auto;">
                    <p:dataTable id="dt-facturacionGeneral" widgetVar="dtFacturacion" var="ventas" value="#{dashboardBean.listaFacturacionGeneral}"
                                 reflow="true" paginator="true" rows="10" paginatorPosition="bottom" rowSelectMode="add" style="min-width:600px">

                        <p:column headerText="Fecha" style="text-align:center; white-space:nowrap;">
                            <h:outputText value="#{ventas.fecha}">
                                <f:convertDateTime pattern="dd/MM/yyyy"/>
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Facturación al día" style="text-align:center">
                            <h:outputText value="#{ventas.total_facturacion}">
                                <f:convertNumber currencySymbol="$" type="currency" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Mes VS Mes" style="text-align:center">
                            <h:outputText value="#{ventas.porcentaje} %"
                                          styleClass="#{(ventas.porcentaje ge 0 ? 'green' : (ventas.porcentaje lt 0 ? 'red' : null))}" />
                        </p:column>

                        <p:column headerText="Pendiente por cobrar (factura)" style="text-align:center">
                            <h:outputText value="#{ventas.total_facturacion}">
                                <f:convertNumber currencySymbol="$" type="currency" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Pendiente por cobrar (efectivo)" style="text-align:center">
                            <h:outputText value="#{ventas.total_por_efectivo}">
                                <f:convertNumber currencySymbol="$" type="currency" />
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </p:outputPanel>

                <f:facet name="footer">
                    <p:commandButton value="Cerrar" onclick="PF('dlgDesglose').hide();" styleClass="p-button-secondary"/>
                </f:facet>
            </p:dialog>
            
            <h5 class="text-center mb-3">Ventas Totales</h5>
            <p:panelGrid columns="3" styleClass="ui-noborder ui-panelgrid-blank" columnClasses="col-12 md:col-4, col-12 md:col-4, col-12 md:col-4">
                <p:panel header="Ventas Totales" styleClass="text-center">
                    <h:outputText value="#{dashboardBean.ventasGlobales.ventasTotales}">
                        <f:convertNumber currencySymbol="$" type="currency" />
                    </h:outputText>
                </p:panel>

                <p:panel header="Ganancias" styleClass="text-center">
                    <h:outputText value="#{dashboardBean.ventasGlobales.ganancias}">
                        <f:convertNumber currencySymbol="$" type="currency" />
                    </h:outputText>
                </p:panel>

                <p:panel header="Porcentaje" styleClass="text-center">
                    <h:outputText value="#{dashboardBean.ventasGlobales.porcentajeGanancias}">
                        <f:convertNumber pattern="##0.00" />
                    </h:outputText> %
                </p:panel>
            </p:panelGrid>
            
            <p:divider />
            
            <div class="grid p-fluid p-mb-4">
                <div class="col-12 md:col-6">
                    <p:dataTable id="dt-ventasMes" widgetVar="dtVM" var="ventasM"
                                 value="#{dashboardBean.listaImporteGlobal}" reflow="true"
                                 style="width:100%;">
                        <f:facet name="header">
                            <h5>Ventas Por Mes</h5>
                        </f:facet>

                        <p:column headerText="Mes" style="text-align:left; white-space:nowrap;">
                            <h:outputText value="#{ventasM.fecha}">
                                <f:convertDateTime pattern="MM/yyyy" />
                            </h:outputText>
                        </p:column>

                        <p:column headerText="Venta" style="text-align:center;">
                            <h:outputText value="#{ventasM.pagosPorMes}">
                                <f:convertNumber currencySymbol="$" type="currency" />
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </div>
                
                <p:divider />

                <div class="col-12 md:col-6">
                    <p:dataTable id="dt-ventaRS" widgetVar="dtVRS" var="ventaRS"
                                 value="#{dashboardBean.listaVentaRazonSocial}" reflow="true"
                                 style="width:100%;">
                        <f:facet name="header">
                            <h5>Ventas Por Razón Social</h5>
                        </f:facet>

                        <p:column headerText="Razón Social" style="text-align:left;">
                            <h:outputText value="#{ventaRS.razonSocial}" />
                        </p:column>

                        <p:column headerText="Venta" style="text-align:center;">
                            <h:outputText value="#{ventaRS.total_facturacion}">
                                <f:convertNumber currencySymbol="$" type="currency" />
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>
            
            <p:divider />
            
            <div class="grid p-fluid p-mt-4">
                <div class="col-12">
                    <p:dataTable id="dt-gananciaRS" widgetVar="dtGananciaRS" var="gananciaRS"
                                 value="#{dashboardBean.listaGananciaRazonSocial}" reflow="true"
                                 style="width:100%;">
                        <f:facet name="header">
                            <h5>Ganancia Por Razón Social</h5>
                        </f:facet>

                        <p:column headerText="Razón Social" style="text-align:left;">
                            <h:outputText value="#{gananciaRS.razonSocial}" />
                        </p:column>

                        <p:column headerText="Venta" style="text-align:center;">
                            <h:outputText value="#{gananciaRS.total_facturacion}">
                                <f:convertNumber currencySymbol="$" type="currency" />
                            </h:outputText>
                        </p:column>
                    </p:dataTable>
                </div>
            </div>
            
            <p:divider />

            <div class="p-grid p-fluid p-mb-4">
                <div class="col-12 md:col-6">
                    <p:donutChart model="#{dashboardBean.donutModel}" style="width:100%; height:400px;" />
                </div>
                <div class="col-12 md:col-6">
                    <p:barChart model="#{dashboardBean.smVentasFormaPago}" style="width:100%; height:400px;" />
                </div>
            </div>
        </h:form>
    </ui:define>

</ui:composition>