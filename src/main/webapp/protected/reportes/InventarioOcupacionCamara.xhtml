<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" 
                template="/WEB-INF/template.xhtml">
    <ui:define name="title">Ocupaci칩n C치maras</ui:define>
    <ui:define name="content">
        <h:form id="form" enctype="multipart/form-data">
            <!-- Controles comunes: Notificaciones, Dialogo "STATUS" y Dialogo Confirmar (Global) -->
            <ui:include src="/protected/common/status-info.xhtml" />
            
            <p:panel>
                <div class="p-grid ui-fluid p-col-12">
                    <div class="p-col-6 p-md-6">
                        <p:outputLabel for="Cliente" value="Cliente" />
                        <p:selectOneMenu id="Cliente" value="#{reporteInventarioOcupacionCamaraBean.clienteSelect}" converter="entityConverter" filter="true" filterMatchMode="contains" autoWidth="false" >
                            <f:selectItem itemLabel="Todos los clientes" noSelectionOption="true" />
                            <f:selectItems value="#{reporteInventarioOcupacionCamaraBean.listaClientes}" var="cliente"  itemLabel="#{cliente.nombre}#{cliente.alias == null ? '' : ' ('.concat(cliente.alias).concat(')')}" itemValue="#{cliente}" />
                            <p:ajax process ="@this" />
                        </p:selectOneMenu>
                    </div>

                    <div class="p-col-6 p-md-6">
                        <p:outputLabel  for="so-planta" value="Planta" />
                        <p:selectOneMenu id="so-planta" value="#{reporteInventarioOcupacionCamaraBean.plantaSelect}" converter="entityConverter" autoWidth="false" >
                            <f:selectItem itemLabel="Todas las plantas" noSelectionOption="true" />
                            <f:selectItems value="#{reporteInventarioOcupacionCamaraBean.listaPlanta}" var="p" itemLabel="#{p.plantaDs}" itemValue="#{p}" />
                            <p:ajax process ="@this" />
                        </p:selectOneMenu>
                    </div>
                    <div class="p-col-4 p-md-4">
                        <p:commandButton value="PDF" actionListener="#{reporteInventarioOcupacionCamaraBean.exportarPdf}" process="@this" ajax="false" styleClass="ui-button-raised ui-button-secondary" onstart="PF('statusInfoDialog').show();" oncomplete="PF('statusInfoDialog').hide();" >
                            <p:fileDownload value="#{reporteInventarioOcupacionCamaraBean.file}" />
                        </p:commandButton>
                    </div>
                    <div class="p-col-4 p-md-4">
                        <p:commandButton value="Excel"  actionListener="#{reporteInventarioOcupacionCamaraBean.exportarExcel}" action="#{reporteInventarioOcupacionCamaraBean.sleep()}" process="@this" ajax="false" styleClass="ui-button-raised ui-button-secondary" onstart="PF('statusInfoDialog').show();" oncomplete="PF('statusInfoDialog').hide();" >
                            <p:fileDownload value="#{reporteInventarioOcupacionCamaraBean.file}" />
                        </p:commandButton>
                    </div>
                    <div class="p-col-4 p-md-4">
                        <p:commandButton value="Consultar" styleClass="ui-button-raised ui-button-secondary" actionListener="#{reporteInventarioOcupacionCamaraBean.ocupacionCamara()}" onstart="PF('statusInfoDialog').show();" oncomplete="PF('statusInfoDialog').hide();" />
                    </div>
                </div>
            </p:panel>

            <p:dataTable id="dt-OcupacionCamara" value="#{reporteInventarioOcupacionCamaraBean.clientesUnicos}" var="cliente" rowKey="#{cliente}" >
                <p:column width="1rem">
                    <p:rowToggler/>
                </p:column>

                <p:column headerText="Cliente" style="text-align: center" >
                    <h:outputText value="#{cliente}" />
                </p:column>

                <p:column headerText="Total" style="text-align:right">
                    <h:outputText value="#{reporteInventarioOcupacionCamaraBean.totalPorCliente(cliente)}" />
                </p:column>

                <p:column width="6rem" style="text-align: center;">
                    <p:commandButton value="Grafica" oncomplete="PF('dlg-grafica').show()" update="@widgetVar(dlg-grafica)" actionListener="#{reporteInventarioOcupacionCamaraBean.createPieModel(cliente)}" />
                </p:column>

                <p:rowExpansion>
                    <p:dataTable value="#{reporteInventarioOcupacionCamaraBean.plantasPorCliente(cliente)}" var="p">
                        <p:column headerText="Planta">
                            <h:outputText value="#{p.planta_ds}" />
                        </p:column>
                        <p:column headerText="Posiciones" style="text-align:right">
                            <h:outputText value="#{p.tarima}" />
                        </p:column>
                    </p:dataTable>
                </p:rowExpansion>
            </p:dataTable>

            <p:dialog header="Ocupaci칩n de c치maras" modal="true" widgetVar="dlg-grafica" responsive="true" showEffect="fade" style="width: 80vw; max-width: 900px; max-height: 720px;" position="top" >
                <p:outputPanel id="grafica-panel" class="ui-fluid" >
                    <p:pieChart rendered="#{not empty reporteInventarioOcupacionCamaraBean.pieModel}" 
                        model="#{reporteInventarioOcupacionCamaraBean.pieModel}" style="width:100%; height:250px;" />
                </p:outputPanel>
                
                <p:outputPanel id="posicionesTarimas" class="ui-fluid" style="text-align:center;" >
                    <h:outputText value="Total: #{reporteInventarioOcupacionCamaraBean.totalPosicionesPorCliente} posiciones ocupadas" />
                </p:outputPanel>
                
                <f:facet name="footer">
                    <p:commandButton value="Cerrar" oncomplete="PF('dlg-grafica').hide()" />
                </f:facet>
            </p:dialog>   
        </h:form>
    </ui:define>
</ui:composition>
