<!-- servicios-tab.xhtml -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <p:dataTable id="dt-servicios" widgetVar="dtServicios" value="#{serviciosCliente.lstPrecioServicioFiltered}" rowKey="#{pServicio.id}"
                 var="pServicio" selection="#{serviciosCliente.precioServicioSelected}" reflow="true" lazy="true" paginator="true"
                 rows="5" rowSelectMode="add" paginatorPosition="bottom">

        <f:facet name="header">
            <div class="products-table-header">
                <span style="font-weight: bold">Servicios por cliente</span>
                <span class="filter-container ui-input-icon-left">
                    <p:commandButton id="btnAdd" icon="pi pi-plus" value="Agregar nuevo servicio"
                                     actionListener="#{serviciosCliente.nuevoServicioCliente()}" process="@this"
                                     styleClass="ui-button-raised" style="margin-right: .5rem"
                                     update="form:tabView:panel-servicio"
                                     oncomplete="PF('servicioClienteDialog').show()"
                                     disabled="#{serviciosCliente.clienteSelected eq null and serviciosCliente.clienteSelected.cteCve eq null}" />
                </span>
            </div>
        </f:facet>

        <p:column headerText="Servicio" sortBy="#{pServicio.servicio.servicioDs}">
            <h:outputText value="#{pServicio.servicio.servicioDs}" />
        </p:column>
        <p:column headerText="Unidad" sortBy="#{pServicio.unidad.unidadDeManejoDs}" width="7rem" style="text-align: center;">
            <h:outputText value="#{pServicio.unidad.unidadDeManejoDs}" />
        </p:column>
        <p:column headerText="Precio" sortBy="#{pServicio.precio}" width="6rem" style="text-align: right;">
            <h:outputText value="#{pServicio.precio}">
                <f:convertNumber type="currency" maxFractionDigits="2" />
            </h:outputText>
        </p:column>
        <p:column width="2rem" style="text-align: center;">
            <p:commandButton icon="pi pi-pencil" process="@this" styleClass="edit-button" oncomplete="PF('servicioClienteDialog').show()"
                             update="form:tabView:panel-servicio">
                <f:setPropertyActionListener value="#{pServicio}" target="#{serviciosCliente.precioServicioSelected}" />
            </p:commandButton>
        </p:column>
        <p:column width="2rem" style="text-align: center;">
            <p:commandButton class="ui-button-danger" icon="pi pi-times" process="@this" oncomplete="PF('deleteServicioDialog').show()">
                <f:setPropertyActionListener value="#{pServicio}" target="#{serviciosCliente.precioServicioSelected}" />
            </p:commandButton>
        </p:column>
    </p:dataTable>

    <!-- Diálogo para agregar/editar -->
                        <p:dialog header="Detalle del servicio" showEffect="fade" modal="false" widgetVar="servicioClienteDialog" responsive="true" position="center center"
                                  width="100%" resizable="false">
                            <p:outputPanel id="panel-servicio" class="ui-fluid">
                                <p:outputPanel>
                                    <div class="p-field">
                                        <p:outputLabel>Cliente</p:outputLabel>
                                        <p:inputText value="#{serviciosCliente.clienteSelected.nombre}" disabled="true" />
                                    </div>
                                    <div class="p-field">
                                        <p:outputLabel>Servicio</p:outputLabel>
                                        <p:selectOneMenu value="#{serviciosCliente.precioServicioSelected.servicio}" filter="true" filterMatchMode="contains"
                                                         converter="entityConverter" required="true" requiredMessage="Seleccione servicio" autoWidth="false"
                                                         disabled="#{serviciosCliente.precioServicioSelected.id ne null}">
                                            <f:selectItem itemLabel="--Selecciona--" />
                                            <f:selectItems value="#{serviciosCliente.lstServicio}" var="serv" itemLabel="#{serv.servicioDs}" />
                                        </p:selectOneMenu>
                                    </div>
                                    <div class="p-field">
                                        <p:outputLabel>Unidad</p:outputLabel>
                                        <p:selectOneMenu value="#{serviciosCliente.precioServicioSelected.unidad}" filter="true" filterMatchMode="contains"
                                                         converter="entityConverter" required="true" requiredMessage="Seleccione unidad"
                                                         disabled="#{serviciosCliente.precioServicioSelected.id ne null}">
                                            <f:selectItem itemLabel="--Selecciona--" />
                                            <f:selectItems value="#{serviciosCliente.lstUnidadManejo}" var="unidad" itemLabel="#{unidad.unidadDeManejoDs}" itemValue="#{unidad}" />
                                        </p:selectOneMenu>
                                    </div>
                                    <div class="p-field">
                                        <p:outputLabel>Precio</p:outputLabel>
                                        <p:inputNumber value="#{serviciosCliente.precioServicioSelected.precio}" emptyValue="0" symbol="$" symbolPosition="p" thousandSeparator=","
                                                       minValue="0" required="true" requiredMessage="Campo requerido" />
                                    </div>
                                </p:outputPanel>
                            </p:outputPanel>

                            <f:facet name="footer">
                                <p:commandButton value="Guardar" icon="pi pi-check" actionListener="#{serviciosCliente.guardarPrecioServicio()}"
                                                 update="panel-servicio" process="panel-servicio @this" />
                                <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('servicioClienteDialog').hide()" class="ui-button-secondary"
                                                 update="panel-servicio" resetValues="true" />
                            </f:facet>
                        </p:dialog>

                        <!-- Diálogo de confirmación -->
                        <p:confirmDialog widgetVar="deleteServicioDialog" showEffect="fade" width="400" message="Desea eliminar el servicio?" header="Eliminar"
                                         severity="warn">
                            <p:commandButton value="Sí" icon="pi pi-check" process="@this" actionListener="#{serviciosCliente.eliminarPrecioServicio()}"
                                             update="" oncomplete="PF('deleteServicioDialog').hide()" />
                            <p:commandButton value="No" type="button" styleClass="ui-button-secondary" icon="pi pi-times" onclick="PF('deleteServicioDialog').hide()" />
                        </p:confirmDialog>
</ui:composition>
