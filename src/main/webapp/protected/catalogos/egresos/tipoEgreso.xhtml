<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" 
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <h:form id="form">

        <ui:decorate template="/protected/catalogos/catalogoBaseEgreso.xhtml">

            <!-- Bean del catálogo -->
            <ui:param name="catalogoBean" value="#{tipoEgresoBean}" />

            <ui:define name="mensajes">
                <p:growl id="messages" showDetail="true" />
            </ui:define>

            <ui:define name="loadingDialog">
                <p:dialog modal="true" widgetVar="statusInfoDialog" header="Cargando información..." draggable="false"
                          closable="false" resizable="false">
                    <div align="center">
                        <i class="pi pi-spinner pi-spin" style="font-size:3rem;"></i>
                    </div>
                </p:dialog>
            </ui:define>

            <ui:define name="toolbar">
                <p:toolbar styleClass="p-mb-4">
                    <p:toolbarGroup>

                        <p:commandButton value="Agregar Tipo"
                                         style="margin-right: .5rem"
                                         actionListener="#{tipoEgresoBean.nuevoOExistente(null)}"
                                         action="#{categoriaEgresoBean.cargarHijos(tipoEgresoBean.selected)}"
                                         icon="pi pi-plus"
                                         update="form:dialogForm"
                                         onstart="PF('statusInfoDialog').show();"
                                         oncomplete="PF('statusInfoDialog').hide(); PF('dlg').show()">
                        </p:commandButton>

                        <p:outputLabel value="Tipos vigentes:" style="margin-right:8px" />
                        <p:inputSwitch value="#{tipoEgresoBean.estado}">
                            <p:ajax listener="#{tipoEgresoBean.vigentesONoVigentes()}" process="@this" update="form:table" />
                        </p:inputSwitch>
                    </p:toolbarGroup>
                </p:toolbar>
            </ui:define>

            <!-- BLOQUES DEL TEMPLATE -->
            <ui:define name="tituloDialogo">
                <h:outputText
                    value="#{tipoEgresoBean.selected.id == null 
                             ? 'Agregar Tipo de Egreso' 
                             : 'Editar Tipo de Egreso'}"
                    style="font-size:1.5rem; font-weight:bold;" />
            </ui:define>
            <ui:define name="campoDescripcion" />
            <ui:define name="columnasDescripcion" />
            <ui:define name="botonEditar">
                <p:commandButton icon="pi pi-pencil" styleClass="ui-button-info p-mr-2"
                                 actionListener="#{tipoEgresoBean.nuevoOExistente(item)}"
                                 action="#{categoriaEgresoBean.cargarHijos(tipoEgresoBean.selected)}"
                                 process="@this" update="form:dialog" oncomplete="PF('dlg').show()" />

            </ui:define>
            
            <ui:define name="botonVigencia">
                <p:commandButton icon="#{item.vigente ? 'pi pi-times' : 'pi pi-check'}"
                                 styleClass="#{item.vigente ? 'ui-button-danger' : 'ui-button-success'} p-ml-2"
                                 title="#{item.vigente ? 'Deshabilitar' : 'Habilitar'}"
                                 process="@this"
                                 action="#{tipoEgresoBean.cambiarVigencia(item)}"
                                 update=":form:table"/>
            </ui:define>

            <ui:define name="camposExtra">
                <p:commandButton value="Agregar Categoria"
                                 style="margin-right: .5rem"
                                 icon="pi pi-plus" disabled="#{empty tipoEgresoBean.selected or tipoEgresoBean.selected.id lt 1}">              
                </p:commandButton>
            </ui:define> 

            <ui:define name="camposExtra">
                <p:outputLabel value="Categorias vigentes:" style="margin-right:8px" />
                <p:inputSwitch value="#{categoriaEgresoBean.estado}">
                    <p:ajax listener="#{categoriaEgresoBean.cargarHijos(tipoEgresoBean.selected)}" process="@this" update="form:dialogForm:tablaCategorias" />
                </p:inputSwitch>
            </ui:define>

            <ui:define name="tablaDialogo">
                <p:dataTable id="tablaCategorias" value="#{categoriaEgresoBean.lst}" var="item" rowKey="#{item.id}" 
                             paginator="true" rows="6" paginatorPosition="bottom">
                    <p:column headerText="Nombre">
                        #{item.nombre}
                    </p:column>

                    <p:column  headerText="Acciones" style="width:150px">

                        <p:commandButton icon="pi pi-pencil" styleClass="ui-button-info p-mr-2"
                                         actionListener="#{categoriaEgreso.nuevoOExistente(item)}"
                                         action="#{catConconceptoEgresoBean.cargarHijos(categoriaEgresoBean.selected)}"
                                         process="@this" update="form:dialog" oncomplete="PF('dlg').show()" />


                        <p:commandButton id="btnVigenciaCategoria"
                                         icon="#{item.vigente ? 'pi pi-times' : 'pi pi-check'}"
                                         styleClass="#{item.vigente ? 'ui-button-danger' : 'ui-button-success'} p-ml-2"
                                         title="#{item.vigente ? 'Deshabilitar' : 'Habilitar'}"
                                         process="@this"
                                         action="#{categoriaEgresoBean.cambiarVigenciaSeleccionado()}"
                                         actionListener="#{categoriaEgresoBean.nuevoOExistente(item)}"
                                         update=":form:dialogForm:tablaCategorias">
                        </p:commandButton>
                    </p:column>

                </p:dataTable>
            </ui:define>

        </ui:decorate>

    </h:form>

</ui:composition>