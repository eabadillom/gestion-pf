<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:p="http://primefaces.org/ui">

    <div class="products-table-header" style="background-color: #CCCCCC;">
        <p:commandButton icon="pi pi-user-plus" styleClass="ui-button-success" style="margin-right: .5rem"
            actionListener="#{clientesBean.nuevoAviso()}" process="@this" oncomplete="PF('dialogContacto').show();"
            resetValues="true" update="form:tabView:pnlContacto" />
    </div>

    <div class="orders-subtable">
        <p:dataTable id="dt-avisos" widgetVar="dtAvisos" var="pAviso" value="#{avisosComercialBean.lstAvisos}"
            reflow="true" styleClass="avisos-table" rowKey="#{pAviso.avisoCve}" paginator="true" rows="10"
            rowSelectMode="add" responsive="true" paginatorPosition="bottom" lazy="true">
            <p:column headerText="Clave">
                <h:outputText value="#{pAviso.avisoCve}" />
                <h:outputText
                    value="#{('-').concat(pAviso.categoriaCve.categoriaDs).concat('-').concat(pAviso.avisoVigencia)}" />
            </p:column>
            <p:column headerText="P.O.">
                <h:outputText value="#{pAviso.avisoPo eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="Pedimento">
                <h:outputText value="#{pAviso.avisoPedimento eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="Contenedor">
                <h:outputText value="#{pAviso.avisoSap eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="LOTE">
                <h:outputText value="#{pAviso.avisoLote eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="Caducidad">
                <h:outputText value="#{pAviso.avisoCaducidad eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="Tarima">
                <h:outputText value="#{pAviso.avisoTarima eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="Vigencia">
                <h:outputText value="#{pAviso.avisoVigencia}" />
            </p:column>
            <p:column headerText="Plazo">
                <h:outputText value="#{pAviso.avisoPlazo}" />
            </p:column>
            <p:column width="10%">
                <p:commandButton icon="pi pi-pencil" update=":form:panel-actAviso :form:soPlantaAct "
                    oncomplete="PF('actAvisoDialog').show()" styleClass="edit-button ui-button-primary" process="@this"
                    actionListener="#{avisosComercialBean.buscaPrecioServicioAviso(pAviso)}">
                    <f:setPropertyActionListener value="#{pAviso}" target="#{avisosComercialBean.avisoSelected}" />
                </p:commandButton>
                <p:commandButton class="ui-button-danger" icon="pi pi-trash" process="@this"
                    oncomplete="PF('avisoDialogDelete').show()">
                    <f:setPropertyActionListener value="#{pAviso}" target="#{avisosComercialBean.avisoSelected}" />
                </p:commandButton>
            </p:column>
        </p:dataTable>
    </div>

    <p:dialog id="dialogAviso" header="Actualizar Aviso" showEffect="fade" modal="true" widgetVar="actAvisoDialog"
        responsive="true" width="900px">
        <p:outputPanel id="panel-actAviso" class="ui-fluid">
            <p:outputPanel rendered="#{avisosComercialBean.avisoSelected ne null}">
                <div class="p-formgrid p-grid">
                    <div class="p-field p-col-12 p-md-12">
                        <p:selectBooleanCheckbox id="aviso-po-m" itemLabel="P.O."
                            value="#{avisosComercialBean.avisoSelected.avisoPo}" />
                        <p:selectBooleanCheckbox id="aviso-ped-m" itemLabel="Pedimento"
                            value="#{avisosComercialBean.avisoSelected.avisoPedimento}" />
                        <p:selectBooleanCheckbox id="aviso-sap-m" itemLabel="Contenedor"
                            value="#{avisosComercialBean.avisoSelected.avisoSap}" />
                        <p:selectBooleanCheckbox id="aviso-lote-m" itemLabel="Lote"
                            value="#{avisosComercialBean.avisoSelected.avisoLote}" />
                        <p:selectBooleanCheckbox id="aviso-cad-m" itemLabel="Caducidad"
                            value="#{avisosComercialBean.avisoSelected.avisoCaducidad}" />
                        <p:selectBooleanCheckbox id="aviso-tarima-m" itemLabel="Tarima"
                            value="#{avisosComercialBean.avisoSelected.avisoTarima}" />
                        <p:selectBooleanCheckbox id="aviso-codigo-m" itemLabel="Código"
                            value="#{avisosComercialBean.avisoSelected.avisoCodigo}" />
                        <p:selectBooleanCheckbox id="aviso-otro-m" itemLabel="Otro"
                            value="#{avisosComercialBean.avisoSelected.avisoOtro}" />
                    </div>
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="@next" value="Valor del seguro" />
                        <p:inputText value="#{avisosComercialBean.avisoSelected.avisoValSeg}" />
                        <p:outputLabel for="@next" value="Temperatura" />
                        <p:inputText disabled="true" value="#{avisosComercialBean.avisoSelected.avisoTemp}" />
                        <p:outputLabel for="@next" value="Planta" />
                        <p:selectOneMenu id="soPlantaAct" value="#{avisosComercialBean.plantaCveSelected}" filter="true"
                            filterMatchMode="contains">
                            <f:selectItem itemLabel="--Seleccione--" />
                            <f:selectItems value="#{avisosComercialBean.lstPlanta}" var="planta"
                                itemLabel="#{planta.plantaDs}" itemValue="#{planta.plantaCve}" />
                        </p:selectOneMenu>
                        <p:outputLabel for="@next" value="Observaciones" />
                        <p:inputText disabled="true" value="#{avisosComercialBean.avisoSelected.avisoObservaciones}" />
                    </div>
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="@next" value="Tipo facturación" />
                        <p:selectOneMenu id="soTpFacturacion-m"
                            value="#{avisosComercialBean.avisoSelected.avisoTpFacturacion}">
                            <f:selectItem itemLabel="--Seleccione--" />
                            <f:selectItem itemLabel="Por Kg" itemValue="K" />
                            <f:selectItem itemLabel="Por Tarima" itemValue="T" />
                        </p:selectOneMenu>
                        <p:outputLabel for="@next" value="Categoria" />
                        <p:selectOneMenu id="soCategoriaAct" converter="entityConverter" disabled="true"
                            value="#{avisosComercialBean.categoriaSelected}" filter="true" filterMatchMode="contains">
                            <f:selectItem itemLabel="--Seleccione--" />
                            <f:selectItems value="#{avisosComercialBean.lstCategoria}" var="categoria"
                                itemLabel="#{categoria.categoriaDs}" itemValue="#{categoria}" />
                        </p:selectOneMenu>
                        <p:outputLabel for="@next" value="Vigencia en días" />
                        <p:inputText value="#{avisosComercialBean.avisoSelected.avisoVigencia}" />
                        <p:outputLabel for="@next" value="Plazo de pago en días" />
                        <p:inputText value="#{avisosComercialBean.avisoSelected.avisoPlazo}" />
                    </div>
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="@next" value="Servicios disponibles" />
                        <p:dataTable id="dt-servicioSinAviso" scrollable="true" scrollHeight="150"
                            styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines"
                            widgetVar="dtServicioSinAviso" var="pServicioSinAviso"
                            value="#{avisosComercialBean.lstPrecioServicio}" reflow="true"
                            selection="#{avisosComercialBean.lstPrecioServicioSelected}"
                            rowKey="#{pServicioSinAviso.id}" rowSelectMode="add" lazy="true">
                            <p:column width="5%" selectionMode="multiple" exportable="false" />
                            <p:column headerText="Servicio">
                                <h:outputText value="#{pServicioSinAviso.servicio.servicioDs}" />
                            </p:column>
                        </p:dataTable>
                        <p:commandButton id="botonColocaAviso" value="Agregar servicios"
                            actionListener="#{avisosComercialBean.agregaServicio()}" update="panel-actAviso dt-avisos"
                            process="dt-servicioSinAviso @this" />
                    </div>
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="@next" value="Servicios con este aviso" />
                        <p:dataTable id="dt-servicioAviso" scrollable="true" scrollHeight="150"
                            styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines"
                            widgetVar="dtServicioAviso" var="pServicioAviso"
                            value="#{avisosComercialBean.lstPrecioServicioAviso}" reflow="true"
                            rowKey="#{pServicioAviso.id}" lazy="true">
                            <p:column headerText="Servicio">
                                <h:outputText value="#{pServicioAviso.servicio.servicioDs}" />
                            </p:column>
                            <p:column headerText="Precio">
                                <p:inputText value="#{pServicioAviso.precio}" />
                            </p:column>
                            <p:column headerText="Unidad">
                                <h:outputText value="#{pServicioAviso.unidad.unidadDeManejoDs}" />
                            </p:column>
                            <p:column width="10%">
                                <p:commandButton id="botonQuitaAviso" class="ui-button-danger" icon="pi pi-trash"
                                    actionListener="#{avisosComercialBean.eliminaServicio(pServicioAviso)}"
                                    update="form:panel-actAviso form:dt-avisos" process="@this dt-servicioAviso" />
                            </p:column>
                        </p:dataTable>
                    </div>
                </div>
            </p:outputPanel>
        </p:outputPanel>

        <f:facet name="footer">
            <p:commandButton id="botonActualizaAviso" value="Actualiza Aviso"
                action="#{avisosComercialBean.actualizaAviso()}" update="panel-actAviso dt-avisos soPlantaAct"
                process="panel-actAviso @this" onclick="PF('actAvisoDialog').hide()" />
            <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('actAvisoDialog').hide()"
                actionListener="#{avisosComercialBean.resetSelectedItems()}" class="ui-button-secondary"
                resetValues="true" process="@this" immediate="true" />
        </f:facet>
    </p:dialog>

</ui:composition>