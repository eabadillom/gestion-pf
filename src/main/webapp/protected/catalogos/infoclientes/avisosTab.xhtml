<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <div class="products-table-header" style="background-color: #CCCCCC;">
        <p:commandButton icon="pi pi-user-plus" styleClass="ui-button-success" style="margin-right: .5rem"
                         actionListener="#{clientesBean.nuevoAviso()}" process="@this" oncomplete="PF('dialogContacto').show();"
                         resetValues="true" update="form:tabView:pnlContacto" />
    </div>

    <div class="orders-subtable">
        <p:dataTable id="dt-avisos" widgetVar="dtAvisos" var="pAviso" value="#{clientesBean.clienteSelected.avisoList}"
                     reflow="true" styleClass="avisos-table" rowKey="#{pAviso.avisoCve}" paginator="true" rows="10"
                     rowSelectMode="add" paginatorPosition="bottom" lazy="true">
            <p:column headerText="Clave">
                <h:outputText value="#{pAviso.avisoCve}" />
                <h:outputText
                    value="#{('-').concat(pAviso.categoriaCve.categoriaDs).concat('-').concat(pAviso.avisoVigencia)}" />
            </p:column>
            <p:column headerText="P.O.">
                <h:outputText value="#{pAviso.avisoPo eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="Pedimento">
                <h:outputText value="#{pAviso.avisoPedimento eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="Contenedor">
                <h:outputText value="#{pAviso.avisoSap eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="LOTE">
                <h:outputText value="#{pAviso.avisoLote eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="Caducidad">
                <h:outputText value="#{pAviso.avisoCaducidad eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="Tarima">
                <h:outputText value="#{pAviso.avisoTarima eq true ? 'Si':'No'}" />
            </p:column>
            <p:column headerText="Vigencia">
                <h:outputText value="#{pAviso.avisoVigencia}" />
            </p:column>
            <p:column headerText="Plazo">
                <h:outputText value="#{pAviso.avisoPlazo}" />
            </p:column>
            <p:column width="10%">
                <p:commandButton icon="pi pi-pencil" update=":form:panel-actAviso :form:soPlantaAct "
                                 oncomplete="PF('actAvisoDialog').show()" styleClass="edit-button ui-button-primary" process="@this"
                                 actionListener="#{clientesBean.copiarAviso(pAviso)}"/>
                <p:commandButton class="ui-button-danger" icon="pi pi-trash" process="@this"
                                 oncomplete="PF('deleteAvisoDialog').show()" actionListener="#{clientesBean.copiarAviso(aviso)}" />
            </p:column>
        </p:dataTable>
    </div>

    <p:dialog id="dialogAviso" header="#{clientesBean.tituloDialogAviso}" showEffect="fade" modal="true" widgetVar="actAvisoDialog"
              responsive="true" width="900px">
        <p:outputPanel id="panel-actAviso" class="ui-fluid">
            <p:outputPanel rendered="#{clientesBean.avisoSelected ne null}">
                <div class="p-formgrid p-grid">
                    <div class="p-field p-col-12 p-md-12">
                        <p:selectBooleanCheckbox id="aviso-po-m" itemLabel="P.O."
                                                 value="#{clientesBean.avisoSelected.avisoPo}" />
                        <p:selectBooleanCheckbox id="aviso-ped-m" itemLabel="Pedimento"
                                                 value="#{clientesBean.avisoSelected.avisoPedimento}" />
                        <p:selectBooleanCheckbox id="aviso-sap-m" itemLabel="Contenedor"
                                                 value="#{clientesBean.avisoSelected.avisoSap}" />
                        <p:selectBooleanCheckbox id="aviso-lote-m" itemLabel="Lote"
                                                 value="#{clientesBean.avisoSelected.avisoLote}" />
                        <p:selectBooleanCheckbox id="aviso-cad-m" itemLabel="Caducidad"
                                                 value="#{clientesBean.avisoSelected.avisoCaducidad}" />
                        <p:selectBooleanCheckbox id="aviso-tarima-m" itemLabel="Tarima"
                                                 value="#{clientesBean.avisoSelected.avisoTarima}" />
                        <p:selectBooleanCheckbox id="aviso-codigo-m" itemLabel="Código"
                                                 value="#{clientesBean.avisoSelected.avisoCodigo}" />
                        <p:selectBooleanCheckbox id="aviso-otro-m" itemLabel="Otro"
                                                 value="#{clientesBean.avisoSelected.avisoOtro}" />
                    </div>
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="@next" value="Valor del seguro" />
                        <p:inputText value="#{clientesBean.avisoSelected.avisoValSeg}" />
                        <p:outputLabel for="@next" value="Temperatura" />
                        <p:inputText disabled="true" value="#{clientesBean.avisoSelected.avisoTemp}" />
                        <p:outputLabel for="@next" value="Planta" />
                        <p:selectOneMenu id="soPlantaAct" value="#{clientesBean.avisoSelected.plantaCve}" filter="true"
                                         filterMatchMode="contains">
                            <f:selectItem itemLabel="--Seleccione--" />
                            <f:selectItems value="#{clientesBean.lstPlanta}" var="planta"
                                           itemLabel="#{planta.plantaDs}" itemValue="#{planta.plantaCve}" />
                        </p:selectOneMenu>
                        <p:outputLabel for="@next" value="Observaciones" />
                        <p:inputText disabled="true" value="#{clientesBean.avisoSelected.avisoObservaciones}" />
                    </div>
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="@next" value="Tipo facturación" />
                        <p:selectOneMenu id="soTpFacturacion-m"
                                         value="#{clientesBean.avisoSelected.avisoTpFacturacion}">
                            <f:selectItem itemLabel="--Seleccione--" />
                            <f:selectItem itemLabel="Por Kg" itemValue="K" />
                            <f:selectItem itemLabel="Por Tarima" itemValue="T" />
                        </p:selectOneMenu>
                        <p:outputLabel for="@next" value="Categoria" />
                        <p:selectOneMenu id="soCategoriaAct" converter="entityConverter" disabled="true"
                                         value="#{clientesBean.avisoSelected.categoriaCve}" filter="true" filterMatchMode="contains">
                            <f:selectItem itemLabel="--Seleccione--" />
                            <f:selectItems value="#{clientesBean.lstCategoria}" var="categoria"
                                           itemLabel="#{categoria.categoriaDs}" itemValue="#{categoria}" />
                        </p:selectOneMenu>
                        <p:outputLabel for="@next" value="Vigencia en días" />
                        <p:inputText value="#{clientesBean.avisoSelected.avisoVigencia}" />
                        <p:outputLabel for="@next" value="Plazo de pago en días" />
                        <p:inputText value="#{clientesBean.avisoSelected.avisoPlazo}" />
                    </div>
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="@next" value="Servicios disponibles" />
                        <p:dataTable id="dt-servicioSinAviso" scrollable="true" scrollHeight="150"
                                     styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines"
                                     widgetVar="dtServicioSinAviso" var="pServicioSinAviso"
                                     value="#{clientesBean.avisoSelected.precioServicioList}" reflow="true"
                                     rowKey="#{pServicioSinAviso.id}" rowSelectMode="add" lazy="true">
                            <p:column width="5%" selectionMode="multiple" exportable="false" />
                            <p:column headerText="Servicio">
                                <h:outputText value="#{pServicioSinAviso.servicio.servicioDs}" />
                            </p:column>
                        </p:dataTable>
                        <p:commandButton id="botonColocaAviso" value="Agregar servicios"
                                         actionListener="#{clientesBean.operarAvisos('agregarservicio')}" update="panel-actAviso dt-avisos"
                                         process="dt-servicioSinAviso @this" />
                    </div>
                    <div class="p-field p-col-12 p-md-6">
                        <p:outputLabel for="@next" value="Servicios con este aviso" />
                        <p:dataTable id="dt-servicioAviso" scrollable="true" scrollHeight="150"
                                     styleClass="ui-datatable-striped ui-datatable-sm ui-datatable-gridlines"
                                     widgetVar="dtServicioAviso" var="pServicioAviso"
                                     value="#{clientesBean.avisoSelected. lstPrecioServicioAviso}" reflow="true"
                                     rowKey="#{pServicioAviso.id}" lazy="true">
                            <p:column headerText="Servicio">
                                <h:outputText value="#{pServicioAviso.servicio.servicioDs}" />
                            </p:column>
                            <p:column headerText="Precio">
                                <p:inputText value="#{pServicioAviso.precio}" />
                            </p:column>
                            <p:column headerText="Unidad">
                                <h:outputText value="#{pServicioAviso.unidad.unidadDeManejoDs}" />
                            </p:column>
                            <p:column width="10%">
                                <p:commandButton id="botonQuitaAviso" class="ui-button-danger" icon="pi pi-trash"
                                                 actionListener="#{clientesBean.eliminaServicio(pServicioAviso)}"
                                                 update="form:panel-actAviso form:dt-avisos" process="@this dt-servicioAviso" oncomplete="PF('deleteServicioDialog').show()" />
                            </p:column>
                        </p:dataTable>
                    </div>
                </div>
            </p:outputPanel>
        </p:outputPanel>

        <f:facet name="footer">
            <p:commandButton id="botonActualizaAviso" value="Actualiza Aviso"
                             action="#{clientesBean.actualizaAviso()}" update="panel-actAviso dt-avisos soPlantaAct"
                             process="panel-actAviso @this" onclick="PF('actAvisoDialog').hide()" />
            <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('actAvisoDialog').hide()"
                             actionListener="#{clientesBean.resetSelectedItems()}" class="ui-button-secondary"
                             resetValues="true" process="@this" immediate="true" />
        </f:facet>
    </p:dialog>

    <p:dialog header="Detalle del servicio" showEffect="fade" modal="false" widgetVar="servicioAvisoDialog" responsive="true" position="center center"
              width="100%" resizable="false">
        <p:outputPanel id="panel-servicio-aviso" class="ui-fluid">
            <p:outputPanel>
                <div class="p-field">
                    <p:outputLabel>Aviso</p:outputLabel>
                    <h:inputText value="#{clientesBean.avisoSelected.avisoCve}'-'#{clientesBean.avisoSelected.categoriaCve.categoriaDs}'-'#{clientesBean.avisoSelected.avisoVigencia}" disabled="true"/>
                </div>
                <div class="p-field">
                    <p:outputLabel>Servicio</p:outputLabel>
                    <p:selectOneMenu value="#{clientesBean.precioAvisoSelected.servicio}" filter="true" filterMatchMode="contains"
                                     converter="entityConverter" required="true" requiredMessage="Seleccione servicio" autoWidth="false"
                                     disabled="#{clientesBean.precioAvisoSelected.servicio.servicioCve ne null}">
                        <f:selectItem itemLabel="--Selecciona--" />
                        <f:selectItems value="#{clientesBean.lstServicio}" var="serv" itemLabel="#{serv.servicioDs}" />
                    </p:selectOneMenu>
                </div>
                <div class="p-field">
                    <p:outputLabel>Unidad</p:outputLabel>
                    <p:selectOneMenu value="#{clientesBean.precioAvisoSelected.unidad}" filter="true" filterMatchMode="contains"
                                     converter="entityConverter" required="true" requiredMessage="Seleccione unidad"
                                     disabled="#{clientesBean.precioAvisoSelected.id ne null}">
                        <f:selectItem itemLabel="--Selecciona--" />
                        <f:selectItems value="#{clientesBean.lstUnidadManejo}" var="unidad" itemLabel="#{unidad.unidadDeManejoDs}" itemValue="#{unidad}" />
                    </p:selectOneMenu>
                </div>
                <div class="p-field">
                    <p:outputLabel>Precio</p:outputLabel>
                    <p:inputNumber value="#{clientesBean.precioAvisoSelected.precio}" emptyValue="0" symbol="$" symbolPosition="p" thousandSeparator=","
                                   minValue="0" required="true" requiredMessage="Campo requerido" />
                </div>
            </p:outputPanel>
        </p:outputPanel>
     <f:facet name="footer">
         <p:commandButton value="Guardar" icon="pi pi-check" actionListener="#{clientesBean.operarAvisos('agregarservicio')}"
                             update="form:tabView" process="panel-servicio @this" oncomplete="PF('servicioAvisoDialog').hide()" />
            <p:commandButton value="Cancelar" icon="pi pi-times" oncomplete="PF('servicioAvisoDialog').hide()" class="ui-button-secondary"
                             update="form:tabView" resetValues="true" />
        </f:facet>
    </p:dialog>

    <p:dialog header="Confirmar eliminación"
              widgetVar="deleteServicioDialog"
              modal="false"
              closable="false"
              resizable="false"
              draggable="false"
              width="400"
              showEffect="fade"
              hideEffect="fade">

        <h:outputText value="¿Desea eliminar el servicio?" style="font-size: 16px;" />

        <p:spacer height="20" />

        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px;">
            <p:commandButton value="Sí"
                             icon="pi pi-check"
                             styleClass="ui-button-danger"
                             actionListener="#{clientesBean.operarAvisos('eliminarservicio')}"
                             update="form:tabView:dt-servicios"
                             oncomplete="PF('deleteServicioDialog').hide()" />

            <p:commandButton value="No"
                             type="button"
                             icon="pi pi-times"
                             styleClass="ui-button-secondary"
                             onclick="PF('deleteServicioDialog').hide()" />
        </div>
    </p:dialog>


    <p:dialog header="Confirmar eliminación"
              widgetVar="deleteAvisoDialog"
              modal="false"
              closable="false"
              resizable="false"
              draggable="false"
              width="400"
              showEffect="fade"
              hideEffect="fade">

        <h:outputText value="¿Desea eliminar el Aviso?" style="font-size: 16px;" />

        <p:spacer height="20" />

        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px;">
            <p:commandButton value="Sí"
                             icon="pi pi-check"
                             styleClass="ui-button-danger"
                             actionListener="#{clientesBean.operarAvisos('eliminaraviso')}"
                             update="form:tabView:dt-servicios"
                             oncomplete="PF('deleteServicioDialog').hide()" />

            <p:commandButton value="No"
                             type="button"
                             icon="pi pi-times"
                             styleClass="ui-button-secondary"
                             onclick="PF('deleteAvisoDialog').hide()" />
        </div>
    </p:dialog>


</ui:composition>