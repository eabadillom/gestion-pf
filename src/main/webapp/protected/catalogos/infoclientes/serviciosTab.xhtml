<!-- servicios-tab.xhtml -->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <div>
        <p:commandButton id="sevicioAdd"
                         icon="pi pi-plus"
                         value="Nuevo servicio"
                         actionListener="#{clientesBean.nuevoPrecioServicio()}"
                         process="@this"
                         update="form:tabView:dialogPrecioServicio form:tabView:pnlServicio"
                         oncomplete="PF('dialogPrecioServicio').show()"
                         styleClass="ui-button-raised"
                         style="margin-right: .5rem; width: auto;"
                         disabled="#{clientesBean.clienteSelected == null}" />
    </div>



    <p:dataTable id="dt-servicios" widgetVar="dtServicios" value="#{clientesBean.clienteSelected.precioServicioList}" rowKey="#{pServicio.id}"
                 var="pServicio" reflow="true" lazy="false" paginator="true"
                 rows="5" paginatorPosition="bottom">

        <p:column headerText="Servicio" sortBy="#{pServicio.servicio.servicioDs}">
            <h:outputText value="#{pServicio.servicio.servicioDs}" />
        </p:column>
        <p:column headerText="Unidad" sortBy="#{pServicio.unidad.unidadDeManejoDs}" width="7rem" style="text-align: center;">
            <h:outputText value="#{pServicio.unidad.unidadDeManejoDs}" />
        </p:column>
        <p:column headerText="Precio" sortBy="#{pServicio.precio}" width="6rem" style="text-align: right;">
            <h:outputText value="#{pServicio.precio}">
                <f:convertNumber type="currency" maxFractionDigits="2" />
            </h:outputText>
        </p:column>
        <p:column width="2rem" style="text-align: center;">
            <p:commandButton icon="pi pi-pencil" process="@this" styleClass="edit-button" oncomplete="PF('dialogPrecioServicio').show()"
                             update="form:tabView:dialogPrecioServicio form:tabView:pnlServicio">
                <f:setPropertyActionListener value="#{pServicio}" target="#{clientesBean.precioServicioSelected}" />
            </p:commandButton>
        </p:column>
        <p:column width="2rem" style="text-align: center;">
            <p:commandButton class="ui-button-danger" icon="pi pi-trash" process="@this" oncomplete="PF('deleteServicioDialog').show()">
                <f:setPropertyActionListener value="#{pServicio}" target="#{clientesBean.precioServicioSelected}" />
            </p:commandButton>
        </p:column>
    </p:dataTable>

    <p:dialog id="dialogPrecioServicio" header="#{(clientesBean.precioServicioSelected.id != null) ? 'Actualizar' : 'Agregar'} Precio Servicio" showEffect="fade" modal="false" widgetVar="dialogPrecioServicio" responsive="true" position="center center"
              width="100%" resizable="false" dynamic="true">
        <p:outputPanel id="pnlServicio" class="ui-fluid">
            <p:outputPanel>
                <div class="p-field">
                    <p:outputLabel>Cliente</p:outputLabel>
                    <p:inputText value="#{clientesBean.clienteSelected.nombre}" disabled="true" />
                </div>
                <div class="p-field">
                    <p:outputLabel>Servicio</p:outputLabel>
                    <p:selectOneMenu value="#{clientesBean.precioServicioSelected.servicio}" filter="true" filterMatchMode="contains"
                                     converter="entityConverter" required="true" requiredMessage="Seleccione servicio" autoWidth="false"
                                     disabled="#{clientesBean.precioServicioSelected.id ne null}">
                        <f:selectItem itemLabel="--Selecciona--" />
                        <f:selectItems value="#{clientesBean.lstServicio}" var="serv" itemLabel="#{serv.servicioDs}" />
                    </p:selectOneMenu>
                </div>
                <div class="p-field">
                    <p:outputLabel>Unidad</p:outputLabel>
                    <p:selectOneMenu value="#{clientesBean.precioServicioSelected.unidad}" filter="true" filterMatchMode="contains"
                                     converter="entityConverter" required="true" requiredMessage="Seleccione unidad"
                                     disabled="#{clientesBean.precioServicioSelected.id ne null}">
                        <f:selectItem itemLabel="--Selecciona--" />
                        <f:selectItems value="#{clientesBean.lstUnidadManejo}" var="unidad" itemLabel="#{unidad.unidadDeManejoDs}" itemValue="#{unidad}" />
                    </p:selectOneMenu>
                </div>
                <div class="p-field">
                    <p:outputLabel>Precio</p:outputLabel>
                    <p:inputNumber value="#{clientesBean.precioServicioSelected.precio}" emptyValue="0" symbol="$" symbolPosition="p" thousandSeparator=","
                                   minValue="0" required="true" requiredMessage="Campo requerido" />
                </div>
            </p:outputPanel>
        </p:outputPanel>

        <f:facet name="footer">
            <p:commandButton value="#{(clientesBean.precioServicioSelected.id != null) ? 'Actualizar' : 'Agregar'}" icon="pi pi-check" actionListener="#{clientesBean.operarServicios('agregarprecioservicio')}"
                             update="form:tabView:dt-servicios" process="pnlServicio @this" oncomplete="PF('dialogPrecioServicio').hide()" />
            <p:commandButton value="Cancelar" icon="pi pi-times" oncomplete="PF('dialogPrecioServicio').hide()" class="ui-button-secondary"
                             update="form:tabView:dt-servicios" resetValues="true" />
        </f:facet>
    </p:dialog>

    <p:dialog header="Confirmar eliminación"
              widgetVar="deleteServicioDialog"
              modal="false"
              closable="false"
              resizable="false"
              draggable="false"
              width="400"
              showEffect="fade"
              hideEffect="fade"
              dynamic="true">

        <h:outputText value="¿Desea eliminar el servicio?" style="font-size: 16px;" />

        <p:spacer height="20" />

        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px;">
            <p:commandButton value="Sí"
                             icon="pi pi-check"
                             styleClass="ui-button-danger"
                             actionListener="#{clientesBean.operarServicios('eliminarprecioservicio')}"
                             update="form:tabView:dt-servicios"
                             oncomplete="PF('deleteServicioDialog').hide()" />

            <p:commandButton value="No"
                             type="button"
                             icon="pi pi-times"
                             styleClass="ui-button-secondary"
                             onclick="PF('deleteServicioDialog').hide()" />
        </div>
    </p:dialog>
</ui:composition>
