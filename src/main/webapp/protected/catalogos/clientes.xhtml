<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml" xmlns:jsf="http://xmlns.jcp.org/jsf">
    <ui:define name="title">Clientes</ui:define>

    <ui:define name="content">
        <h:form id="form">
            <p:growl id="messages" showDetail="true" />
            <p:dialog modal="true" widgetVar="statusInfoDialog" header="Cargando información..." draggable="false"
                      closable="false" resizable="false">
                <div align="center">
                    <i class="pi pi-spinner pi-spin" style="font-size:3rem;"></i>
                </div>
            </p:dialog>
            <p:toolbar styleClass="p-mb-4">
                <p:toolbarGroup>
                    <p:commandButton value="Nuevo Cliente" icon="pi pi-plus" styleClass="ui-button-raised" style="margin-right: .5rem" actionListener="#{clientesBean.nuevoCliente()}"
                                     process="@this" update="form:tabView:pnlCliente form:tabView:soClienteTipoDom form:tabView:dt-domiciliosCliente" oncomplete="PF('dialogCliente').show();" >
                        <p:resetInput target="form:tabView:pnlCliente"/>
                    </p:commandButton>
                </p:toolbarGroup>
            </p:toolbar>
            <div style="padding-top: 1rem;">
                <p:dataTable id="dtClientes" widgetVar="dtClientes" value="#{clientesBean.lstClientes}" var="cliente" rowKey="#{cliente.cteCve}"  reflow="true" paginator="true" rows="10" rowSelectMode="add" paginatorPosition="bottom">
                    <p:column headerText="Nombre" sortBy="#{cliente.nombre}" filterBy="#{cliente.nombre}" filterMatchMode="contains">
                        <h:outputText value="#{cliente.nombre}" />
                    </p:column>
                    <p:column headerText="Alias" sortBy="#{cliente.alias}" filterBy="#{cliente.alias}">
                        <h:outputText value="#{cliente.alias}" />
                    </p:column>
                    <p:column headerText="RFC" width="7rem" style="text-align: center;">
                        <h:outputText value="#{cliente.cteRfc}" />
                    </p:column>
                    <p:column headerText="Activo" width="2rem" style="text-align: center;">
                        <h:outputText value="#{cliente.habilitado ? 'Sí' : 'No'}" />
                    </p:column>
                    <p:column width="2rem" style="text-align: center;">
                        <p:commandButton icon="pi pi-pencil" styleClass="edit-button" oncomplete="PF('dialogCliente').show(); PF('statusInfoDialog').hide();" 
                                         process="@this" update="form:dialogCliente" actionListener="#{clientesBean.cargarInfoCliente(cliente)}"
                                         resetValues="form:tabView:soClienteTipoDom form:tabView:dt-domiciliosCliente" />
                    </p:column>
                    <p:column width="2rem" style="text-align: center;">
                        <p:commandButton class="ui-button-danger" icon="pi pi-times" process="@this" oncomplete="PF('deleteClienteDialog').show()" />
                    </p:column>
                </p:dataTable>
            </div>


            <p:dialog id="dialogCliente" header="Información del cliente" widgetVar="dialogCliente" showEffect="fade" modal="true" responsive="true">
                <p:tabView id="tabView" class="ui-fluid" dynamic="true" effect="drop">
                    <p:tab title="Fiscal">
                        <ui:include src="infoclientes/fiscalTab.xhtml" />
                    </p:tab>

                    <p:tab title="Contactos">
                        <ui:include src="infoclientes/contactosTab.xhtml"/>
                    </p:tab>

                    <ui:include src="/protected/catalogos/infoclientes/domiciliosTab.xhtml"/>
                    
                    <p:tab title="Servicios">
                        <ui:include src="infoclientes/serviciosTab.xhtml"/>
                    </p:tab>
                    
                    <p:tab title="Avisos">
                        <ui:include src="infoclientes/avisosTab.xhtml"/>
                    </p:tab>

                </p:tabView>
                <f:facet name="footer">
                    <p:commandButton value="Agregar" icon="pi pi-check" process="@this"
                                 actionListener="#{clientesBean.operarCliente('guardarcliente')}" update="dtClientes"
                                 oncomplete="PF('dialogCliente').hide()" />
                    <p:commandButton value="Cancelar" icon="pi pi-times" oncomplete="PF('dialogCliente').hide()"
                                 immediate="true" class="ui-button-secondary" resetValues="true" />
                </f:facet>
            </p:dialog>
            
            <ui:include src="infoclientes/dlgDomiciliosTab.xhtml" />

            <p:dialog id="dialogClonar" header="Copiar información del cliente" widgetVar="dialogClonar"
                      showEffect="fade" modal="true" responsive="true">
                <p:outputPanel>
                    <h:outputLabel value="Seleccione el cliente" />
                    <p:selectOneMenu id="selClonarCliente" value="#{clientesBean.clonarCliente}">
                        <f:selectItem itemLabel="--SELECCIONE EL CLIENTE--" 	/>
                    </p:selectOneMenu>
                </p:outputPanel>
            </p:dialog>

            <p:confirmDialog widgetVar="deleteClienteDialog" showEffect="fade" width="400" message="Desea eliminar el cliente?" header="Eliminar" severity="warn">
                <p:commandButton value="Sí" icon="pi pi-check" process="@this" actionListener="#{clientesBean.operarCliente('eliminarcliente')}" oncomplete="PF('deleteClienteDialog').hide()" />
                <p:commandButton value="No" type="button" styleClass="ui-button-secondary" icon="pi pi-times" onclick="PF('deleteClienteDialog').hide()" />
            </p:confirmDialog>

            <p:confirmDialog global="true" showEffect="fade" width="400" header="Eliminar">
                <p:commandButton value="Sí" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" icon="pi pi-times" />
            </p:confirmDialog>

            <style>
                body .ui-panelgrid .ui-panelgrid-cell {
                    border: none !important;
                    padding: 0px;
                }

                .ui-fluid .ui-password {
                    width: 90% !important;
                    display: inline-block !important;
                }

                body .ui-input-icon-right>i:last-of-type {
                    right: 1rem;
                }

                body .ui-input-icon-right>.ui-inputfield {
                    width: 100%;
                }
                body .ui-panelgrid .ui-panelgrid-cell {
                    border: none !important;
                    padding: 0px;
                }

                .ui-fluid .ui-password {
                    width: 90% !important;
                    display: inline-block !important;
                }

                body .ui-input-icon-right>i:last-of-type {
                    right: 1rem;
                }

                body .ui-input-icon-right>.ui-inputfield {
                    width: 100%;
                }
            </style>
        </h:form>
    </ui:define>
</ui:composition>