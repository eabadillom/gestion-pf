<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/template.xhtml">
	
	<ui:define name="title">Facturacion Entradas/Salidas</ui:define>
	
	<ui:define name="content">
	
		<h:form id="form" >
			<p:breadCrumb>
				<p:menuitem value="Home" outcome="/dashboard" />
				<p:menuitem value="FacturaciÃ³n" />				
				<p:menuitem value="Facturacion Entrada/Salida" outcome="/protected/catalogos/facturacionConstancias" />
			</p:breadCrumb>
		
			<p:growl id="messages" showDetail="true" life="4000"></p:growl>
		
			<div class="p-grid crud-demo">
				<div class="p-col-12">
					<div class="card">
						
						
					<p:fieldset legend="Datos del Receptor (Cliente)" >
						<p:outputPanel id="receptor">
							<div style="text-align: center;margin-bottom: 10px">
								<p:outputLabel value="Cliente:" styleClass="p-ml-2"></p:outputLabel>
								<p:selectOneMenu id="cliente" styleClass="p-ml-2 p-mr-4" converter="entityConverter" autoWidth="false" value="#{facturacionConstanciasBean.clienteSelect}">
									<f:selectItem itemLabel="---Seleccione---" noSelectionOption="true"></f:selectItem>
									<f:selectItems value="#{facturacionConstanciasBean.listaCliente}" var="cliente" itemLabel="#{cliente.cteNombre}" itemValue="#{cliente}"/>
									<p:ajax update="receptor factura" listener="#{facturacionConstanciasBean.domicilioAvisoPorCliente}"></p:ajax>						
								</p:selectOneMenu>
							</div>
							
							<p:outputLabel value="Numero:" styleClass="p-mr-2" />
							<p:inputNumber value="#{facturacionConstanciasBean.clienteSelect.numeroCte}" decimalPlaces="0"/>
							
							<p:outputLabel value="Razon Social:" styleClass="p-ml-4 p-mr-2" />
							<p:inputText value="#{facturacionConstanciasBean.clienteSelect.cteNombre}" style="width: 22%;"/>
							
							<p:outputLabel value="RFC:" styleClass="p-ml-4 p-mr-2"/>
							<p:inputText value="#{facturacionConstanciasBean.clienteSelect.cteRfc}" />
							
							<p:outputLabel value="Domicilio:" styleClass="p-ml-4 p-mr-2" />
							<p:selectOneMenu id="domicilio" autoWidth="flase" converter="entityConverter" value="#{facturacionConstanciasBean.domicilioSelect}">
								<f:selectItem itemLabel="---Seleccione---" noSelectionOption="true"/>
								<f:selectItems value="#{facturacionConstanciasBean.listaClienteDomicilio}" var="domicilio" itemLabel="#{domicilio.domicilios.domicilioCalle}" itemValue="#{domicilio.domicilios}" />
							</p:selectOneMenu>
													
						</p:outputPanel>
					</p:fieldset>
					
					<p:fieldset legend="Datos del Emisor" styleClass="p-mt-2">
						<p:outputLabel value="Sucursal (Planta):" style="float:left;">		
							<p:selectOneMenu id="planta" autoWidth="false" converter="entityConverter" value="#{facturacionConstanciasBean.plantaSelect}" styleClass="p-ml-2 p-mr-4">
								<f:selectItem itemLabel="---Seleccione---" noSelectionOption="true"/>
								<f:selectItems value="#{facturacionConstanciasBean.listaPlanta}" var="planta" itemLabel="#{planta.plantaDs}" itemValue="#{planta}"/>
								<p:ajax update="emisor" listener="#{facturacionConstanciasBean.serieFactura}"/>
							</p:selectOneMenu>
						</p:outputLabel>
						
						<p:outputPanel id="emisor">
						
							<p:outputLabel value="Razon Social:" styleClass="p-mr-2" />
							<p:inputText value="#{facturacionConstanciasBean.plantaSelect.idEmisoresCFDIS.nb_emisor}" style="width: 22%" />
							
							<p:outputLabel value="RFC:" styleClass="p-ml-4 p-mr-2"/>
							<p:inputText value="#{facturacionConstanciasBean.plantaSelect.idEmisoresCFDIS.nb_rfc}" />
							
							<p:outputLabel value="factura:" styleClass="p-ml-4 p-mr-2"/>
							<p:selectOneMenu id="serieFactura" autoWidth="false" converter="entityConverter" value="#{facturacionConstanciasBean.serieFacturaSelect}">
								<f:selectItem itemLabel="---Seleccione---" />
								<f:selectItems  value="#{facturacionConstanciasBean.listaSerieFactura}" var="serieFactura" itemLabel="#{serieFactura.nomSerie}-#{serieFactura.numeroActual + 1}"/>
							</p:selectOneMenu>
						
						</p:outputPanel>
												
					</p:fieldset>
														
					<p:fieldset legend="Datos de la Facturacion" styleClass="p-mt-2">
						<p:outputPanel id="factura">
							<div>
								<p:outputLabel value="Fecha Facturacion:" />
								<p:datePicker id="fechaFact" showIcon="true" placeholder="Fecha de Factura" value="#{facturaConstanciasBean.fechaFactura}" 
												styleClass="p-ml-2 p-mr-4" size="13"/>
								
								<p:outputLabel value="Moneda:" />
								<p:inputText value="#{facturacionConstanciasBean.moneda}" styleClass="p-ml-2 p-mr-4" style="width: 5%"/>
								
								<p:outputLabel value="Plazo de Pago:" />
								<p:selectOneMenu id="plazo" autoWidth="false" value="#{facturacionConstanciasBean.plazoSelect}" styleClass="p-ml-2 p-mr-4" >
									<f:selectItem itemLabel="---Seleccione---" noSelectionOption="true"/>
									<f:selectItems value="#{facturacionConstanciasBean.listaAviso}" var="aviso" itemLabel="#{aviso.avisoPlazo}" itemValue="#{aviso.avisoPlazo}"/>
								</p:selectOneMenu>
								
								<p:outputLabel value="Metodo de Pago (SAT):"/>
								<p:selectOneMenu id="metodoPago" autoWidth="false" styleClass="p-ml-2 p-mr-4" converter="entityConverter" value="#{facturacionConstanciasBean.metodoPagoSelect}" >
									<f:selectItem itemLabel="---Seleccione---"  noSelectionOption="true"/>
									<f:selectItems value="#{facturacionConstanciasBean.listaMetodoPago}" var="metodoP" itemLabel="#{metodoP.cdMetodoPago}-#{metodoP.nbMetodoPago}" />
								</p:selectOneMenu>
								
								<p:outputLabel value="Forma de pago (SAT):" />
								<p:selectOneMenu id="medioPago" autoWidth="false" styleClass="p-ml-2" converter="entityConverter" value="#{facturacionConstanciasBean.medioPagoSelect}" >
									<f:selectItem itemLabel="---Seleccione---" noSelectionOption="true"/>
									<f:selectItems value="#{facturacionConstanciasBean.listaMedioPago}" var="medioP" itemLabel="#{medioP.mpId}-#{medioP.mpDescripcion}" itemValue="#{medioP}" />
								</p:selectOneMenu>
								
							</div>
							
							<div style="margin-top:10px">
								
								<p:outputLabel value="Referencia:" />
								<p:inputText styleClass="p-ml-2 p-mr-4" ></p:inputText>
								
								<p:outputLabel value="IVA:"/>
								<p:inputNumber styleClass="p-ml-2" size="4" value="#{facturacionConstanciasBean.iva.valor * 100}"/>%
								
								<p:outputLabel value="Retencion:" styleClass="p-ml-4 p-mr-2"/>
								<p:selectBooleanCheckbox onIcon="pi pi-check" offIcon="pi pi-times"/>
								<p:inputNumber styleClass="p-ml-2" size="4" value="#{facturacionConstanciasBean.retencion.valor * 100}"/>%
								
								<p:outputLabel value="Valor Declarado:"  styleClass="p-ml-4 p-mr-2"/>
								<p:inputNumber />
								
								<p:outputLabel value="Seguro:" styleClass="p-ml-4 p-mr-2"/>
								<p:inputNumber  />%
							
							</div>
							
							<div style="margin-top:10px">
							
								<p:outputLabel value="Observaciones:" styleClass="p-mr-2" />
								<p:inputTextarea autoResize="true"/>
							
							</div>
												
							
						</p:outputPanel>
					</p:fieldset>			
					
					<p:fieldset legend="Constancias a Facturar" style="margin-top:10px"> <!-- falta outputPanel para Autoupdate -->
										
						<div style="margin-top:10px" >
							<p:outputLabel value="Se facturan por primera vez las constancias de deposito. Si la constancia que desea no se encuentra, ya fue facturada"/>
						</div>
						
						<p:dataTable id="dt-constanciasE" emptyMessage="No Hay Constancias Por Facturar" value="#{facturacionConstanciasBean.listaEntradas}"
						 var="entrada" rowKey="#{entrada.folio}" paginator="true" paginatorPosition="bottom" rowSelectMode="add" rows="1" >
							<f:facet name="header">							 
								<div>								
									<span>Constancias De Entradas A Factura</span>								
								</div>							
							</f:facet>
						
							<p:column selectionMode="multiple" exportable="false"/>
						
							<p:column headerText="Folio Cliente">
								<h:outputText value="#{entrada.folioCliente}"/>
							</p:column>
							
							<p:column headerText="Fecha Ingreso">
								<h:outputText value="#{entrada.fechaIngreso}" >
									<f:convertDateTime pattern="dd/MMM/YYYY" />
								</h:outputText>
							</p:column>
						
						</p:dataTable>
						
						<p:separator/>
												
						<p:outputLabel styleClass="p-ml-4"/><b>Fecha de corte:</b>
						<p:datePicker showIcon="true" styleClass="p-ml-2" placeholder="Fecha de Corte" value="#{facturacionConstanciasBean.fechaCorte}"></p:datePicker>
						
						<div style="margin-top:20px">
							<p:outputLabel value="Facturar las vigencias del inventario del cliente" />
						</div>
						
						<p:dataTable id="dt-vigencias" emptyMessage="No Hay Vigencias Por Facturar" value="#{facturacionConstanciasBean.listaVigencias}" 
									 var="vigencia" rowKey="#{vigencia.id}" paginator="true" paginatorPosition="bottom" rowSelectMode="add" rows="1" reflow="true" 
									 lazy="true">
						
							<f:facet name="header">
								<div>
									<span>Vigencias A Facturar</span>
								</div>
							</f:facet>	
							
							<p:column selectionMode="multiple" exportable="false"/>
							
							<p:column headerText="Folio Cliente">
								<h:outputText value="#{vigencia.folio.folioCliente}" />
							</p:column>
							
							<p:column headerText="Fecha Inicio">
								<h:outputText value="#{vigencia.vigenciaInicio}" >
									<f:convertDateTime pattern="dd/MMM/YYYY" />
								</h:outputText>
							</p:column>
							
							<p:column headerText="Fecha Final">
								<h:outputText value="#{vigencia.vigenciaFin}" >
									<f:convertDateTime pattern="dd/MMM/YYYY" />
								</h:outputText>
							</p:column>
						
						</p:dataTable>
						
						<p:separator/>
						
						<p:selectBooleanCheckbox styleClass="p-mr-2" ></p:selectBooleanCheckbox><b>Facturar Constancias de Servicio</b>
						
						<div style="margin-top:4px">
							<p:outputLabel>Se facturan las constancias de servicio. Si la constancia que desea no se encuentra, ya fue facturada</p:outputLabel>
						</div>
					
						<div style="margin-top:20px">						
							<p:outputLabel>[UNIDAD] indica la unidad en que se cobra el servicio</p:outputLabel>						
						</div>
						
						<div>
							<p:outputLabel>[*] Los servicios asi marcados se cobran por tiempo en base al periodo declarado en los campos 
								"Inicio periodo" y "Fin periodo", la CANTIDAD indica el numero de veces que se cobrara ese periodo</p:outputLabel>						
						</div>
						
						<p:dataTable id="dt-servicios" emptyMessage="No Hay Servicios Por Facturar" value="#{facturacionConstanciasBean.listaServicios}"
						 var="servicio" rowKey="#{servicio.id}" paginator="true" paginatorPosition="bottom" rowSelectMode="add" rows="5"  >
							<f:facet name="header">							 
								<div>								
									<span>Constancias De Entradas A Factura</span>								
								</div>							
							</f:facet>
						
							<p:column selectionMode="multiple" exportable="false"/>
						
							<p:column headerText="Folio Cliente">
								<h:outputText value="#{servicio.constanciaDeServicio.folioCliente}"/>
							</p:column>
							
						
						</p:dataTable>
					
					</p:fieldset>
					
					
					<div style="margin-top:10px; text-align: center">
						<p:commandButton value="Guardar" ></p:commandButton>
					</div>
					
					</div>
				</div>
			</div>
		
		
		
		</h:form>
	</ui:define>
</ui:composition>