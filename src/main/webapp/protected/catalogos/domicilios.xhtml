<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">
	<ui:define name="title">Domicilios</ui:define>

	<ui:define name="content">
		<h:form id="form">
			<p:breadCrumb>
				<p:menuitem value="Home" outcome="/dashboard" />
				<p:menuitem value="Facturación" />
				<p:menuitem value="Catálogos" />
				<p:menuitem value="Domicilios" />
				<p:menuitem value="Domicilios por Cliente"
					outcome="/protected/catalogos/domicilios" />
			</p:breadCrumb>
			<p:growl id="messages" showDetail="true" />
			<div class="p-grid domiciliosCliente">
				<div class="p-col-12">
					<div class="card">
						<div class="p-col-12">
							<div class="card">
								<div class="ui-fluid p-formgrid p-grid">
									<div class="p-field p-col-12 p-md-6">
										<p:outputLabel for="soClientes" value="Cliente" />
										<p:selectOneMenu id="soClientes" converter="entityConverter" value="#{domiciliosBean.clienteSelected}" required="true" requiredMessage="Campo requerido" filter="true" filterMatchMode="contains" autoWidth="false">
											<f:selectItem itemLabel="--Selecciona--" />
											<f:selectItems value="#{domiciliosBean.lstClientes}" var="cliente" itemLabel="#{cliente.nombre}#{cliente.alias == null ? '' : ' ('.concat(cliente.alias).concat(')')}" itemValue="#{cliente}" />
											<p:ajax listener="#{domiciliosBean.filtraListado()}" event="change" update="soClienteTipoDom btnAdd dt-domiciliosCliente" />
										</p:selectOneMenu>
									</div>
									<div class="p-field p-col">
										<p:outputLabel for="soClienteTipoDom"
											value="Tipo de domicilio" />
										<p:selectOneMenu id="soClienteTipoDom"
											converter="entityConverter"
											disabled="#{domiciliosBean.clienteSelected eq null and domiciliosBean.clienteSelected.cteCve eq null}"
											value="#{domiciliosBean.tipoDomicilioSelected}"
											required="true" requiredMessage="Campo requerido">
											<f:selectItem itemLabel="--Selecciona--" />
											<f:selectItems value="#{domiciliosBean.lstTiposDomicilio}"
												var="tipoDomicilio"
												itemLabel="#{tipoDomicilio.domicilioTipoDesc}"
												itemValue="#{tipoDomicilio}" />
											<p:ajax listener="#{domiciliosBean.filtraListadoDomicilio()}" event="change" update="btnAdd dt-domiciliosCliente" />
										</p:selectOneMenu>
									</div>
									<div class="p-field p-col-3 p-md-6">
										<span class="filter-container ui-input-icon-left"> <p:commandButton
											id="btnAdd" icon="pi pi-plus" value="Agregar" process="@this"
											update="form:panel-addClienteDireccion"
											styleClass="ui-button-primary" style="margin-right: .5rem"
											actionListener="#{domiciliosBean.limpiaClienteDomicilio()}"
											oncomplete="PF('clienteDireccionesAddDialog').show()"
											disabled="#{domiciliosBean.clienteSelected eq null or domiciliosBean.tipoDomicilioSelected eq null}"
											resetValues="panel-addClienteDireccion" />
										</span>
									</div>
								</div>
							</div>
						</div>
						<p:dataTable id="dt-domiciliosCliente"
							widgetVar="dtDomiciliosCliente"
							value="#{domiciliosBean.lstClienteDomiciliosFiltered}"
							var="pClienteDomicilios"
							rowKey="#{pClienteDomicilios.domicilios.domCve}"
							selection="#{domiciliosBean.clienteDomicilioSelected}"
							reflow="true" lazy="true" paginator="true" rows="10"
							selectionMode="single" rowSelectMode="add"
							paginatorPosition="bottom">
							<f:facet name="header">
								<div class="domiciliosCliente-table-header">
									<span style="font-weight: bold">Domicilios del cliente</span>
									
								</div>
							</f:facet>
							<p:column headerText="Estado">
								<h:outputText
                                                                    value="#{pClienteDomicilios.domicilios.asentamiento.asentamientoHumanoPK.ciudades.municipios.estados.estadoDesc}" />
							</p:column>
							<p:column headerText="Municipio">
								<h:outputText
                                                                    value="#{pClienteDomicilios.domicilios.asentamiento.asentamientoHumanoPK.ciudades.municipios.municipioDs}" />
							</p:column>
							<p:column headerText="Ciudad">
								<h:outputText
                                                                    value="#{pClienteDomicilios.domicilios.asentamiento.asentamientoHumanoPK.ciudades.ciudadDs}" />
							</p:column>
							<p:column headerText="CP">
								<h:outputText
									value="#{pClienteDomicilios.domicilios.domicilioCp}" />
							</p:column>
							<p:column headerText="Calle">
								<h:outputText
									value="#{pClienteDomicilios.domicilios.domicilioCalle}" />
							</p:column>
							<p:column headerText="Núm. Ext.">
								<h:outputText
									value="#{pClienteDomicilios.domicilios.domicilioNumExt}" />
							</p:column>
							<p:column headerText="Núm. Int.">
								<h:outputText
									value="#{pClienteDomicilios.domicilios.domicilioNumInt}" />
							</p:column>
							<p:column headerText="Tipo Domicilio">
								<h:outputText
									value="#{pClienteDomicilios.domicilios.domicilioTipoCve.domicilioTipoDesc}" />
							</p:column>
							<p:column>
								<p:commandButton icon="pi pi-pencil" process="@this"
									styleClass="edit-button ui-button-primary"
									oncomplete="PF('clienteDireccionesAddDialog').show()"
									update="form:panel-addClienteDireccion" action="#{domiciliosBean.pintaActualiza}" >
									<f:setPropertyActionListener value="#{pClienteDomicilios}"
										target="#{domiciliosBean.clienteDomicilioSelected}" />
								</p:commandButton>
								<p:commandButton class="ui-button-danger" icon="pi pi-trash"
									process="@this"
									oncomplete="PF('deleteClienteDireccionesDialog').show()">
									<f:setPropertyActionListener value="#{pClienteDomicilios}"
										target="#{domiciliosBean.clienteDomicilioSelected}" />
								</p:commandButton>
							</p:column>
						</p:dataTable>

						<p:dialog header="Dirección" showEffect="fade"
							modal="true" widgetVar="clienteDireccionesAddDialog"
							responsive="true" id="addDireccionCliente">
							<p:outputPanel id="panel-addClienteDireccion" class="ui-fluid">
								<p:outputPanel>
                                                                    <div class="p-formgrid p-grid">
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel for="@next">Código Postal</p:outputLabel>
                                                                            <p:autoComplete id="autocomplete" placeholder="Escribe el codigo postal..."
                                                                                value="#{domiciliosBean.domicilioSelected.asentamiento}"
                                                                                completeMethod="#{domiciliosBean.sugerenciasCodigoPostal}" 
                                                                                var="sugerencia"
                                                                                itemLabel="#{sugerencia.cp}"
                                                                                itemValue="#{sugerencia}" 
                                                                                forceSelection="true"
                                                                                minQueryLength="5"
                                                                                maxlength="5"
                                                                                converter="entityConverter">
                                                                            </p:autoComplete>
                                                                            <p:ajax process="@this" listener="#{domiciliosBean.asignarDomicilio}" update="form:panel-addClienteDireccion" />
                                                                            <p:column>
                                                                                <p:outputLabel value="#{sugerencia.cp}"/>
                                                                            </p:column>
                                                                            <p:column>
                                                                                <p:outputLabel value="#{sugerencia.asentamientoDs}"/>
                                                                            </p:column>
                                                                        </div>
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel for="@next" value="Pais" />
                                                                            <p:inputText id="pais" value="#{domiciliosBean.domicilioSelected.asentamiento.asentamientoHumanoPK.ciudades.municipios.estados.paises.paisDesc}" >
                                                                                <p:ajax process="@this" />
                                                                            </p:inputText>
                                                                        </div>
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel for="@next" value="Estados" />
                                                                            <p:inputText id="estados" value="#{domiciliosBean.domicilioSelected.asentamiento.asentamientoHumanoPK.ciudades.municipios.estados.estadoDesc}" >
                                                                                <p:ajax process="@this" />
                                                                            </p:inputText>
                                                                        </div>
                                                                    </div>
                                                                    <div class="p-formgrid p-grid">
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel for="@next" value="Municipio" />
                                                                            <p:inputText id="municipio" value="#{domiciliosBean.domicilioSelected.asentamiento.asentamientoHumanoPK.ciudades.municipios.municipioDs}" >
                                                                                <p:ajax process="@this" />
                                                                            </p:inputText>
                                                                        </div>
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel for="@next" value="Ciudad" />
                                                                            <p:inputText id="ciudad" value="#{domiciliosBean.domicilioSelected.asentamiento.asentamientoHumanoPK.ciudades.ciudadDs}" >
                                                                                <p:ajax process="@this" />
                                                                            </p:inputText>
                                                                        </div>
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel for="@next" value="Colonia" />
                                                                            <p:inputText id="colonia" value="#{domiciliosBean.domicilioSelected.asentamiento.asentamientoDs}" >
                                                                                <p:ajax process="@this" />
                                                                            </p:inputText>
                                                                        </div>
                                                                    </div>
                                                                    <div class="p-formgrid p-grid">
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel>Calle</p:outputLabel>
                                                                            <p:inputText value="#{domiciliosBean.domicilioNvoCalle}" />
                                                                        </div>
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel>Número Exterior</p:outputLabel>
                                                                            <p:inputText value="#{domiciliosBean.domicilioNvoNumExt}" />
                                                                        </div>
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel>Número Interior</p:outputLabel>
                                                                            <p:inputText value="#{domiciliosBean.domicilioNvoNumInt}" />
                                                                        </div>
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel>Teléfono 1</p:outputLabel>
                                                                            <p:inputText value="#{domiciliosBean.domicilioNvoTel1}" placeholder="Maximo de 10 caracteres" maxlength="10"/>
                                                                        </div>
                                                                    </div>
                                                                    <div class="p-formgrid p-grid">
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel>Teléfono 2</p:outputLabel>
                                                                            <p:inputText value="#{domiciliosBean.domicilioNvoTel2}" placeholder="Maximo de 10 caracteres" maxlength="10"/>
                                                                        </div>
                                                                        <div class="p-field p-col">
                                                                            <p:outputLabel>Fax</p:outputLabel>
                                                                            <p:inputText value="#{domiciliosBean.domicilioNvoFax}" placeholder="Maximo de 10 caracteres" maxlength="10"/>
                                                                        </div>
                                                                    </div>
								</p:outputPanel>
							</p:outputPanel>

							<f:facet name="footer">
								<p:commandButton value="Guardar" icon="pi pi-check" 
                                                                                actionListener="#{domiciliosBean.guardaClienteDomicilio()}" 
                                                                                onclick="PF('clienteDireccionesAddDialog').hide()" 
                                                                                update="panel-addClienteDireccion" 
                                                                                process="panel-addClienteDireccion @this" 
                                                                                rendered="#{domiciliosBean.domicilioSelected == null}" />
                                                                <p:commandButton value="Actualizar" icon="pi pi-sync"
                                                                                actionListener="#{domiciliosBean.actualizaDomicilio()}"
                                                                                onclick="PF('clienteDireccionesAddDialog').hide()"
                                                                                update="panel-addClienteDireccion"
                                                                                process="panel-addClienteDireccion" 
                                                                                rendered="#{domiciliosBean.domicilioSelected != null}" />
								<p:commandButton value="Cancelar" icon="pi pi-times" 
                                                                                 onclick="PF('clienteDireccionesAddDialog').hide()" 
                                                                                 class="ui-button-secondary" update="panel-addClienteDireccion"  
                                                                                 immediate="true" 
                                                                                 process="@this"/>
							</f:facet>
						</p:dialog>

						<p:confirmDialog widgetVar="deleteClienteDireccionesDialog"
							showEffect="fade" width="400"
							message="¿Desea eliminar esta dirección?" header="Eliminar"
							severity="warn">
							<p:commandButton value="Sí" icon="pi pi-check" process="@this"
								actionListener="#{domiciliosBean.eliminaClienteDomicilio()}"
								update=""
								oncomplete="PF('deleteClienteDireccionesDialog').hide()" />
							<p:commandButton value="No" type="button"
								styleClass="ui-button-secondary" icon="pi pi-times"
								onclick="PF('deleteClienteDireccionesDialog').hide()" />
						</p:confirmDialog>
					</div>
				</div>
			</div>
		</h:form>
	</ui:define>
</ui:composition>
