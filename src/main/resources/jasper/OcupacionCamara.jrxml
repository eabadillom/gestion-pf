<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.21.3.final using JasperReports Library version 6.21.3-4a3078d20785ebe464f18037d738d12fc98c13cf  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="OcupacionCamara" pageWidth="612" pageHeight="792" columnWidth="572" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="d8a15733-41b2-4cd9-aa5b-23ad3c056967">
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="GestionDesarrollo"/>
	<parameter name="imagen" class="java.lang.String">
		<defaultValueExpression><![CDATA["/logo.jpeg"]]></defaultValueExpression>
	</parameter>
	<parameter name="idCliente" class="java.lang.Integer"/>
	<parameter name="idPlanta" class="java.lang.Integer"/>
	<parameter name="fecha" class="java.util.Date"/>
	<queryString language="SQL">
		<![CDATA[WITH i AS (
					    SELECT
					        c.CTE_NOMBRE AS cliente,
					        plt.PLANTA_DS AS planta,
					        cdd.FOLIO,
					        p.PARTIDA_CVE,
					        p.cantidad_total,
					        (p.CANTIDAD_TOTAL - COALESCE(s.cantidad, 0)) AS cantidad,
					        p.peso_total,
					        (p.PESO_TOTAL - COALESCE(s.peso, 0)) AS peso,
					        p.no_tarimas,
					        p.cd_tarima
					    FROM constancia_de_deposito cdd
					    INNER JOIN cliente c ON cdd.CTE_CVE = c.CTE_CVE
					    INNER JOIN partida p ON cdd.folio = p.folio
					    INNER JOIN camara cam ON p.CAMARA_CVE = cam.CAMARA_CVE
					    INNER JOIN planta plt ON cam.PLANTA_CVE = plt.PLANTA_CVE
					    LEFT JOIN (
					        SELECT
					            dcs.PARTIDA_CVE,
					            SUM(dcs.CANTIDAD) AS cantidad,
					            SUM(dcs.PESO) AS peso
					        FROM detalle_constancia_salida dcs
					        INNER JOIN constancia_salida cs ON cs.ID = dcs.CONSTANCIA_CVE
					        WHERE cs.STATUS = 1 AND cs.FECHA <= $P{fecha}
					        GROUP BY dcs.PARTIDA_CVE
					    ) s ON p.PARTIDA_CVE = s.PARTIDA_CVE
					    WHERE cdd.status = 1
					      AND cdd.FECHA_INGRESO <= $P{fecha}
					      AND ($P{idPlanta} IS NULL OR plt.PLANTA_CVE = $P{idPlanta})
					      AND ($P{idCliente} IS NULL OR cdd.cte_cve = $P{idCliente})
					),
					t1 AS (
					    SELECT i.cliente, i.planta, CEILING((i.peso / i.peso_total) * i.no_tarimas) AS tarimas
					    FROM i
					    WHERE i.no_tarimas IS NOT NULL AND i.cd_tarima IS NULL AND i.cantidad > 0
					),
					t2 AS (
					    SELECT i.cliente, i.planta, COUNT(DISTINCT i.cd_tarima) AS tarimas
					    FROM i
					    WHERE i.no_tarimas IS NULL AND i.cd_tarima IS NOT NULL AND i.cantidad > 0
					    GROUP BY i.cliente, i.planta
					)
					SELECT o.cliente, o.planta, SUM(o.tarimas) AS tarimas
					FROM (
					    SELECT * FROM t1
					    UNION ALL
					    SELECT * FROM t2
					) o
					GROUP BY o.cliente, o.planta
					ORDER BY o.cliente, o.planta]]>
	</queryString>
	<field name="cliente" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="cliente"/>
		<property name="com.jaspersoft.studio.field.label" value="cliente"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="cliente"/>
	</field>
	<field name="planta" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="planta"/>
		<property name="com.jaspersoft.studio.field.label" value="planta"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="planta"/>
	</field>
	<field name="tarimas" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="tarimas"/>
		<property name="com.jaspersoft.studio.field.label" value="tarimas"/>
		<property name="com.jaspersoft.studio.field.tree.path" value="tarimas"/>
	</field>
	<variable name="TOTAL_posiciones" class="java.lang.Integer" resetType="Group" resetGroup="Cliente" calculation="Sum">
		<variableExpression><![CDATA[$F{tarimas}]]></variableExpression>
	</variable>
	<group name="Cliente">
		<groupExpression><![CDATA[$F{cliente}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
				<textField>
					<reportElement x="0" y="0" width="572" height="19" forecolor="#2196F3" uuid="78592b3f-1138-4f39-80db-8ac8d5b872c1">
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
					</reportElement>
					<textElement textAlignment="Left" verticalAlignment="Bottom">
						<font size="12" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{cliente}]]></textFieldExpression>
				</textField>
				<line>
					<reportElement x="0" y="19" width="572" height="1" forecolor="#1696F7" backcolor="#1696F7" uuid="5d8cf680-8116-4246-b064-5995f337ae77">
						<property name="com.jaspersoft.studio.unit.width" value="px"/>
					</reportElement>
				</line>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="20">
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
				<staticText>
					<reportElement x="0" y="0" width="380" height="20" uuid="6c242721-4582-44c2-9231-d962423657b0">
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
					</reportElement>
					<textElement textAlignment="Right" verticalAlignment="Top">
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[Total]]></text>
				</staticText>
				<textField>
					<reportElement x="380" y="0" width="100" height="20" uuid="8b9fc825-471d-452a-9120-999a58b21805">
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
					</reportElement>
					<box>
						<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
						<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
						<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
						<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					</box>
					<textElement textAlignment="Right" verticalAlignment="Top">
						<font size="10" isBold="true"/>
					</textElement>
					<textFieldExpression><![CDATA[$V{TOTAL_posiciones}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="480" y="0" width="92" height="20" uuid="6ed371c5-5ae9-4799-98e1-b40fc499eca9">
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
					</reportElement>
					<textElement textAlignment="Center" verticalAlignment="Top" markup="styled">
						<font isBold="true"/>
					</textElement>
					<text><![CDATA[ocupadas]]></text>
				</staticText>
				<line>
					<reportElement x="0" y="0" width="572" height="1" forecolor="#1696F7" backcolor="#1696F7" uuid="8662543a-ecf5-4ef3-94d8-3d1de04176e4">
						<property name="com.jaspersoft.studio.unit.width" value="px"/>
					</reportElement>
				</line>
			</band>
		</groupFooter>
	</group>
	<group name="Planta">
		<groupExpression><![CDATA[$F{planta}]]></groupExpression>
		<groupHeader>
			<band height="12">
				<property name="com.jaspersoft.studio.unit.height" value="px"/>
				<textField>
					<reportElement x="0" y="0" width="380" height="12" uuid="5f0138ee-7251-4c47-a51e-91ca14e537d6">
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
					</reportElement>
					<textElement textAlignment="Left" verticalAlignment="Middle">
						<font size="10"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{planta}]]></textFieldExpression>
				</textField>
				<textField>
					<reportElement x="380" y="0" width="100" height="12" uuid="05e2723a-3a5e-485a-94d3-c3a6269eff1b">
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
					</reportElement>
					<textElement textAlignment="Right" verticalAlignment="Middle">
						<font size="10"/>
					</textElement>
					<textFieldExpression><![CDATA[$F{tarimas}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="480" y="0" width="92" height="12" uuid="14e17fae-4022-4baf-b841-705d2f870cac">
						<property name="com.jaspersoft.studio.unit.y" value="px"/>
						<property name="com.jaspersoft.studio.unit.height" value="px"/>
					</reportElement>
					<textElement textAlignment="Center" verticalAlignment="Middle"/>
					<text><![CDATA[ocupadas]]></text>
				</staticText>
			</band>
		</groupHeader>
	</group>
	<title>
		<band height="49" splitType="Stretch">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<staticText>
				<reportElement x="0" y="0" width="572" height="35" forecolor="#2196F3" backcolor="#FFFFFF" uuid="30f52bc1-2ac4-4519-9a62-c8b6a33f0624">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="14" isBold="true"/>
				</textElement>
				<text><![CDATA[REPORTE DE OCUPACIÓN DE CÁMARAS ]]></text>
			</staticText>
			<image>
				<reportElement x="0" y="0" width="209" height="49" uuid="9bb13c97-a93b-4d87-87c2-d43e36f3d989">
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<imageExpression><![CDATA[$P{imagen}]]></imageExpression>
			</image>
			<staticText>
				<reportElement x="0" y="35" width="280" height="14" uuid="1bc91916-8a0a-4bbc-9cea-4ff5a99fe5e4">
					<property name="com.jaspersoft.studio.unit.rightIndent" value="px"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
				</reportElement>
				<textElement textAlignment="Right">
					<paragraph lineSpacingSize="1.0" rightIndent="10"/>
				</textElement>
				<text><![CDATA[al dia]]></text>
			</staticText>
			<textField pattern="dd &apos;de&apos; MMMM &apos;de&apos; yyyy">
				<reportElement x="280" y="35" width="292" height="14" uuid="8ad489f1-c5db-433f-92d5-563aa9da38f5">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
				</reportElement>
				<textElement verticalAlignment="Top"/>
				<textFieldExpression><![CDATA[$P{fecha}]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="11">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<staticText>
				<reportElement key="" mode="Opaque" x="0" y="0" width="380" height="11" forecolor="#F7EEED" backcolor="#2196F3" uuid="b770f8a7-8ca8-4b57-90db-c0f4319ece14">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Left" verticalAlignment="Middle">
					<font fontName="SansSerif" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Planta]]></text>
			</staticText>
			<staticText>
				<reportElement key="" mode="Opaque" x="380" y="0" width="192" height="11" forecolor="#F7EEED" backcolor="#2196F3" uuid="03bd8f5d-9e0f-4592-a317-1f2ee05c67fe">
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<box>
					<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
					<bottomPen lineWidth="0.0" lineColor="#000000"/>
					<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="SansSerif" size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Posiciones]]></text>
			</staticText>
		</band>
	</pageHeader>
	<pageFooter>
		<band height="8">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<textField>
				<reportElement x="0" y="0" width="572" height="8" uuid="cfbf9434-651d-4681-b8a2-31b7ccc5ebe4">
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
				</reportElement>
				<textElement textAlignment="Right">
					<font fontName="SansSerif" size="5" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA["Página " + $V{PAGE_NUMBER} + " de  " + $V{PAGE_NUMBER}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<noData>
		<band height="100">
			<property name="com.jaspersoft.studio.unit.height" value="px"/>
			<image>
				<reportElement x="0" y="0" width="170" height="50" uuid="97c8ef44-3815-4f6b-9bbd-afd1ff92bbb9">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<imageExpression><![CDATA[$P{imagen}]]></imageExpression>
			</image>
			<staticText>
				<reportElement x="0" y="0" width="572" height="21" forecolor="#2196F3" uuid="e6aa0ed8-67cd-4a85-9c36-228c1dde18b7">
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
				</reportElement>
				<textElement textAlignment="Center">
					<font fontName="SansSerif" size="14" isBold="true"/>
				</textElement>
				<text><![CDATA[REPORTE DE OCUPACIÓN DE CÁMARAS]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="75" width="572" height="25" uuid="b114e88a-40b7-4341-80c8-57bc953cca55">
					<property name="com.jaspersoft.studio.unit.width" value="px"/>
					<property name="com.jaspersoft.studio.unit.x" value="px"/>
					<property name="com.jaspersoft.studio.unit.y" value="px"/>
					<property name="com.jaspersoft.studio.unit.height" value="px"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font fontName="SansSerif" size="12" isBold="true"/>
				</textElement>
				<text><![CDATA[NO SE ENCONTRÓ INFORMACIÓN]]></text>
			</staticText>
		</band>
	</noData>
</jasperReport>
